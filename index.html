<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dosevakt - Medisin & Omsorgslogg</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#FFFFFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Dosevakt">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    
    <!-- iOS/Apple ikoner -->
    <link rel="apple-touch-icon" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="167x167" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./apple-touch-icon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root {
            /* Color Palette - Premium & Modern */
            --bs-primary: #4CAF50;
            --bs-secondary: #2196F3;
            --bs-body-bg: #F5F7FA;
            
            /* Enhanced Gradients */
            --primary-gradient: linear-gradient(135deg, #4CAF50 0%, #43A047 100%);
            --secondary-gradient: linear-gradient(135deg, #2196F3 0%, #1E88E5 100%);
            --accent-gradient: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            --purple-gradient: linear-gradient(135deg, #9C27B0 0%, #8E24AA 100%);
            
            /* Surfaces */
            --bg-card: #FFFFFF;
            --bg-glass: rgba(255, 255, 255, 0.95);
            
            /* Text */
            --text-primary: #1A1A1A;
            --text-secondary: #6c757d;
            
            /* Borders & Shadows */
            --border-color: #EAEAEA;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
            --shadow-lg: 0 16px 48px rgba(0,0,0,0.12);
            --shadow-hover: 0 12px 32px rgba(0,0,0,0.12);
            
            /* Accents */
            --accent-green: #4CAF50;
            --accent-blue: #2196F3;
            --accent-orange: #FF9800;
            --accent-purple: #9C27B0;
            --accent-teal: #00BCD4;
            --accent-pink: #E91E63;
        }
        
        body { 
            padding-top: 160px; /* Adjusted for larger header */
            padding-bottom: calc(100px + env(safe-area-inset-bottom));
            background-color: var(--bs-body-bg);
            color: var(--text-primary);
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }
        
        /* Premium Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            background: rgba(255, 255, 255, 0.95); /* Glassmorphism */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 1px 0px rgba(0,0,0,0.05); /* Subtle separator */
            border-bottom: none;
            height: 140px;
        }

        .header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Modern Icons - Jony Ive Style (Clean, Minimal, White) */
        .app-icon {
            width: 72px;
            height: 72px;
            border-radius: 20px; /* More rounded */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.06), 0 2px 6px rgba(0,0,0,0.04);
            background: #FFFFFF;
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .app-icon:active {
            transform: scale(0.95);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        /* Icon Colors - Applied to text/icon inside the white box */
        .icon-green { color: #34C759; }
        .icon-blue { color: #007AFF; }
        .icon-orange { color: #FF9500; }
        .icon-red { color: #FF3B30; }
        .icon-purple { color: #AF52DE; }
        .icon-teal { color: #5AC8FA; }
        .icon-yellow { color: #FFCC00; }
        .icon-gray { color: #8E8E93; }

        .app-label {
            font-size: 12px;
            font-weight: 500;
            color: #1d1d1f; /* Apple Dark Grey */
            text-align: center;
            letter-spacing: -0.2px;
            margin-top: 4px;
        }

        /* iOS Home Screen Grid (Restored & Updated) */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px 15px; /* More breathing room */
            padding: 10px 0;
            margin-top: 15px;
        }

        @media (max-width: 400px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px 8px;
            }
            .app-icon {
                width: 64px;
                height: 64px;
                border-radius: 16px;
                font-size: 28px;
            }
        }

        .app-icon-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: transparent;
            border: none;
            padding: 0;
            width: 100%;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .app-icon-card:active {
            transform: scale(0.92);
            opacity: 1;
        }


        /* Folder Modal Grid */
        .folder-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding: 10px;
        }
        
        /* Log Cards */
        .log-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }
        
        .log-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .menu-btn {
            color: var(--text-primary);
            font-size: 1.8rem;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: none;
            background: transparent;
            transition: all 0.2s ease;
        }
        
        .menu-btn:active {
            background-color: rgba(0,0,0,0.05);
            transform: scale(0.95);
        }

        /* Container & Cards */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
        }
        
        /* Buttons */
        .btn {
            border-radius: 12px;
            padding: 10px 20px;
            font-weight: 600;
            letter-spacing: 0.3px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .btn-primary {
            background: var(--primary-gradient);
            border: none;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
            background: var(--primary-gradient); /* Keep gradient */
        }
        

        
        .dashboard-card {
            border: none;
            border-radius: 24px;
            padding: 24px 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 160px;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .dashboard-card:active {
            transform: scale(0.98);
        }
        
        .dashboard-card .icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }
        
        .dashboard-card .title {
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dashboard-card .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Quick Actions */
        .quick-actions {
            margin-top: 32px;
            background: var(--bg-card);
            border-radius: 24px;
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .quick-action-grid {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            flex: 1;
            min-width: 100px;
            background: #F8F9FA;
            border: 1px solid transparent;
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .quick-btn:hover {
            background: #FFFFFF;
            border-color: var(--border-color);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        /* Tabs */
        .nav-tabs {
            border-bottom: none;
            background: var(--bg-card);
            padding: 12px 12px 0;
            border-radius: 24px 24px 0 0;
            gap: 8px;
            flex-wrap: nowrap;
            overflow-x: auto;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        
        .nav-tabs::-webkit-scrollbar {
            display: none; /* Hide scrollbar Chrome/Safari */
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 50px; /* Pill shape */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            white-space: nowrap;
            background: #F5F7FA;
        }
        
        .nav-tabs .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.25);
            transform: translateY(-1px);
        }

        /* Inputs & Forms */
        .form-control, .form-select {
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            background-color: #FAFAFA;
            transition: all 0.2s ease;
        }
        
        .form-control:focus, .form-select:focus {
            background-color: #FFFFFF;
            border-color: var(--bs-primary);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.1);
        }

        /* Splash Screen CSS Removed */

        /* Modals */
        .modal-content {
            border: none;
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 24px 24px 16px;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            border-top: none;
            padding: 0 24px 24px;
        }
        
        .modal-title {
            font-weight: 700;
        }

        /* Accordion Premium */
        .accordion-item {
            border: none;
            border-radius: 16px !important;
            margin-bottom: 12px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            background: var(--bg-card);
        }
        
        .accordion-button {
            border-radius: 16px !important;
            font-weight: 600;
            padding: 16px 20px;
            background: transparent;
            box-shadow: none !important;
        }
        
        .accordion-button:not(.collapsed) {
            background: rgba(76, 175, 80, 0.05);
            color: var(--bs-primary);
        }

        /* Lists */
        .list-group-item {
            border: none;
            border-bottom: 1px solid var(--border-color);
            padding: 16px;
        }
        
        .list-group-item:last-child {
            border-bottom: none;
        }

        /* Mobile Optimization */
        @media (max-width: 576px) {
            .container { padding: 0 16px; }
            .dashboard-card { padding: 20px 16px; min-height: 140px; }
            .dashboard-card .icon { font-size: 2rem; }
            .dashboard-card .title { font-size: 1rem; }
            .nav-tabs .nav-link { padding: 10px 14px; font-size: 0.9rem; }
            h1 { font-size: 1.75rem; }
            h2 { font-size: 1.3rem; }
        }

        /* Utility */
        .hidden { display: none !important; }
        .text-muted { color: var(--text-secondary) !important; }

        /* Dark Mode Overrides */
        body.dark-mode {
            --bs-body-bg: #121212;
            --bg-card: #1E1E1E;
            --bg-glass: rgba(30, 30, 30, 0.95);
            --text-primary: #E0E0E0;
            --text-secondary: #B0B0B0;
            --border-color: #333333;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.2);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.3);
            --shadow-lg: 0 16px 48px rgba(0,0,0,0.4);
            --shadow-hover: 0 12px 32px rgba(0,0,0,0.4);
        }

        body.dark-mode .app-header {
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        body.dark-mode .nav-tabs .nav-link {
            background: #2C2C2C;
            color: #B0B0B0;
        }

        body.dark-mode .nav-tabs .nav-link.active {
            color: white;
        }

        body.dark-mode .card, 
        body.dark-mode .dashboard-card,
        body.dark-mode .quick-actions,
        body.dark-mode .list-group-item,
        body.dark-mode .offcanvas {
            background: var(--bg-card);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        body.dark-mode .form-control,
        body.dark-mode .form-select {
            background-color: #2C2C2C;
            border-color: #444;
            color: #E0E0E0;
        }

        body.dark-mode .modal-content {
            background-color: #1E1E1E;
            border-color: #333;
            color: var(--text-primary);
        }

        body.dark-mode .text-dark {
            color: #E0E0E0 !important;
        }

        body.dark-mode .text-muted {
            color: #9aa0a6 !important;
        }

        body.dark-mode .bg-light {
            background-color: #2C2C2C !important;
        }

        body.dark-mode .bg-white {
            background-color: #1E1E1E !important;
        }

        body.dark-mode .header-logo img {
            filter: brightness(0) invert(1);
        }
        
        body.dark-mode .offcanvas-header {
             border-bottom: 1px solid #333;
        }
        
        body.dark-mode .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
    </style>
</head>
<body>
    <!-- Sticky Header -->
    <header class="app-header">
        <div class="header-inner">
            <button class="menu-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar">
                <i class="bi bi-list" style="font-size: 2.5rem;"></i>
            </button>
            <div class="header-logo mx-auto">
                <a href="#" onclick="document.getElementById('home-tab').click(); return false;">
                    <img id="app-header-logo" src="./logo.svg" alt="Dosevakt" style="height: 80px; width: auto; opacity: 0; transform: translateY(-50px) scale(0.5); transition: all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);">
                </a>
            </div>
            <div style="width: 48px; display: flex; justify-content: center; align-items: center;">
                <button class="btn btn-link p-0 text-dark" onclick="window.location.reload(true)" aria-label="Oppdater app">
                    <i class="bi bi-arrow-clockwise" style="font-size: 2rem;"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Splash Screen Removed -->
    
    <div class="container">
        <!-- Tabs (Hidden - Controlled via Hamburger Menu) -->
        <ul class="nav nav-tabs d-none" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button">üè† Hjem</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="checklist-tab" data-bs-toggle="tab" data-bs-target="#checklist" type="button">Sjekkliste</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="log-tab" data-bs-toggle="tab" data-bs-target="#log" type="button">Ny Logg</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="today-tab" data-bs-toggle="tab" data-bs-target="#today" type="button">I dag</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button">Historikk</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reminders-tab" data-bs-toggle="tab" data-bs-target="#reminders" type="button">P√•minnelser</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button">Statistikk</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="timers-tab" data-bs-toggle="tab" data-bs-target="#timers" type="button">Timere</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="spltools-tab" data-bs-toggle="tab" data-bs-target="#spltools" type="button">SplTools</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="meddb-tab" data-bs-toggle="tab" data-bs-target="#meddb" type="button">Medisindatabase</button>
            </li>
        </ul>
        
        <div class="tab-content">
            <!-- Hjem Tab -->
            <div class="tab-pane fade show active" id="home" role="tabpanel">
                <div class="px-3 pt-4 pb-2">
                     <!-- Date Display -->
                    <div id="headerDate" style="text-transform: uppercase; font-size: 0.8rem; font-weight: 600; color: #86868b; letter-spacing: 0.5px; margin-bottom: 4px;"></div>
                    
                    <div class="d-flex justify-content-between align-items-end">
                        <div>
                            <h2 style="font-size: 2.2rem; font-weight: 700; color: #1d1d1f; margin-bottom: 0; letter-spacing: -0.02em;">Hei, <span id="welcomeUserName" style="color: #1d1d1f;">der</span></h2>
                        </div>
                        <button class="btn border-0 p-0 shadow-none" style="width: 40px; height: 40px; border-radius: 50%; background: #f5f5f7; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;" onclick="new bootstrap.Modal(document.getElementById('bgSettingsModal')).show(); BackgroundService.renderLibrary('bgLibraryGrid');">
                            <i class="bi bi-slider" style="font-size: 1.2rem; color: #1d1d1f;"></i>
                        </button>
                    </div>
                </div>

                <!-- Hospitalized Banner -->
                <div id="hospitalizedBanner" class="alert alert-danger d-none mx-3 mb-4 rounded-4 shadow-sm border-0 d-flex align-items-center" role="alert" style="background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%); color: #b71c1c;">
                    <div class="bg-white text-danger rounded-circle d-flex align-items-center justify-content-center me-3 shadow-sm" style="width: 48px; height: 48px; min-width: 48px;">
                        <i class="bi bi-hospital fs-4"></i>
                    </div>
                    <div>
                        <h5 class="alert-heading fw-bold mb-1">Pasient er innlagt</h5>
                        <p class="mb-0 small opacity-75 fw-bold">Daglige gj√∏rem√•l og varsler er midlertidig deaktivert.</p>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Sjekkliste -->
                    <button onclick="document.getElementById('checklist-tab').click()" class="app-icon-card">
                        <div class="app-icon icon-green">
                            <i class="bi bi-clipboard-check"></i>
                        </div>
                        <div class="app-label">Sjekkliste</div>
                    </button>

                    <!-- Ny Logg -->
                    <button onclick="document.getElementById('log-tab').click()" class="app-icon-card">
                        <div class="app-icon icon-blue">
                            <i class="bi bi-pencil-square"></i>
                        </div>
                        <div class="app-label">Ny Logg</div>
                    </button>

                    <!-- Journal (Folder) -->
                    <button data-bs-toggle="modal" data-bs-target="#journalFolderModal" class="app-icon-card">
                        <div class="app-icon icon-yellow">
                            <i class="bi bi-journal-text"></i>
                        </div>
                        <div class="app-label">Journal</div>
                    </button>

                    <!-- MedisinDB -->
                    <button onclick="document.getElementById('meddb-tab').click()" class="app-icon-card">
                        <div class="app-icon icon-purple">
                            <i class="bi bi-capsule"></i>
                        </div>
                        <div class="app-label">MedisinDB</div>
                    </button>

                    <!-- Skanner -->
                        <button onclick="document.getElementById('spltools-tab').click(); setTimeout(() => document.getElementById('scan-tab').click(), 200)" class="app-icon-card">
                            <div class="app-icon icon-gray">
                                <i class="bi bi-upc-scan"></i>
                            </div>
                            <div class="app-label">Skanner</div>
                        </button>

                        <!-- Helseoversikt (NY) -->
                        <button onclick="openStatistics()" class="app-icon-card">
                            <div class="app-icon icon-red">
                                <i class="bi bi-activity"></i>
                            </div>
                            <div class="app-label">Helse</div>
                        </button>

                    <!-- Verkt√∏y (Folder) -->
                    <button data-bs-toggle="modal" data-bs-target="#toolsFolderModal" class="app-icon-card">
                        <div class="app-icon icon-gray">
                            <i class="bi bi-tools"></i>
                        </div>
                        <div class="app-label">Verkt√∏y</div>
                    </button>

                    <!-- P√•minnelser -->
                    <button onclick="document.getElementById('reminders-tab').click()" class="app-icon-card">
                        <div class="app-icon icon-orange">
                            <i class="bi bi-bell-fill"></i>
                        </div>
                        <div class="app-label">Varsler</div>
                    </button>
                </div>
            </div>
            
            <!-- Sjekkliste Tab -->
            <div class="tab-pane fade" id="checklist" role="tabpanel">
                <!-- Header -->
                <div class="px-3 pt-4 pb-2 mb-3">
                    <div class="text-uppercase fw-bold text-muted small mb-1" style="letter-spacing: 0.5px;">Oversikt</div>
                    <h2 class="fw-bold text-dark mb-0" style="font-size: 2.2rem; letter-spacing: -0.02em;">Sjekkliste</h2>
                </div>

                <!-- Hospitalized Banner (Checklist) -->
                <div id="hospitalizedBannerChecklist" class="alert alert-danger d-none mx-3 mb-4 rounded-4 shadow-sm border-0 d-flex align-items-center" role="alert" style="background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%); color: #b71c1c;">
                    <div class="bg-white text-danger rounded-circle d-flex align-items-center justify-content-center me-3 shadow-sm" style="width: 48px; height: 48px; min-width: 48px;">
                        <i class="bi bi-hospital fs-4"></i>
                    </div>
                    <div>
                        <h5 class="alert-heading fw-bold mb-1">Pasient er innlagt</h5>
                        <p class="mb-0 small opacity-75 fw-bold">Sjekklisten er skjult.</p>
                    </div>
                </div>

                <!-- New Compact Quick Actions Toolbar -->
                <div class="d-flex gap-2 mb-4 overflow-auto pb-2 px-1" style="scrollbar-width: none; -ms-overflow-style: none;">
                    <button class="btn btn-white border-0 shadow-sm rounded-4 d-flex align-items-center gap-2 px-3 py-2 flex-shrink-0" data-bs-toggle="modal" data-bs-target="#bowelModal">
                        <div style="background: #FFF3E0; color: #EF6C00; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 1.2rem;">üí©</span>
                        </div>
                        <span class="fw-bold small text-dark">Avf√∏ring</span>
                    </button>
                    
                    <button class="btn btn-white border-0 shadow-sm rounded-4 d-flex align-items-center gap-2 px-3 py-2 flex-shrink-0" data-bs-toggle="modal" data-bs-target="#vannlatingModal">
                        <div style="background: #E3F2FD; color: #1565C0; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 1.2rem;">üíß</span>
                        </div>
                        <span class="fw-bold small text-dark">Vannlating</span>
                    </button>
                    
                    <button class="btn btn-white border-0 shadow-sm rounded-4 d-flex align-items-center gap-2 px-3 py-2 flex-shrink-0" data-bs-toggle="modal" data-bs-target="#vomitModal">
                        <div style="background: #FFEBEE; color: #C62828; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 1.2rem;">ü§Æ</span>
                        </div>
                        <span class="fw-bold small text-dark">Oppkast</span>
                    </button>
                </div>
                
                <!-- Medicine Checklist Container -->
                <div id="medicineChecklist" class="d-flex flex-column gap-3 pb-3">
                    <!-- Content injected by app.js -->
                </div>
                
                <!-- Add Medicine Button -->
                <button class="btn btn-outline-primary w-100 mb-4 rounded-pill fw-bold py-3 border-2 dashed-border" data-bs-toggle="modal" data-bs-target="#addMedicineModal">
                    <i class="bi bi-plus-lg me-2"></i>Legg til ny medisin
                </button>

                <!-- Sondemat Header & List -->
                <div class="d-flex align-items-center mb-3 mt-4">
                    <div class="bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                        <i class="bi bi-droplet-fill"></i>
                    </div>
                    <h6 class="text-uppercase text-muted fw-bold mb-0" style="font-size: 0.8rem; letter-spacing: 0.5px;">Sondemat</h6>
                </div>
                
                <div id="sondeChecklist" class="d-flex flex-column gap-3 pb-3">
                     <!-- Content injected by app.js -->
                </div>
                
                <button class="btn btn-outline-warning w-100 mb-4 rounded-pill fw-bold py-3 border-2 dashed-border text-dark" data-bs-toggle="modal" data-bs-target="#addSondematModal">
                    <i class="bi bi-plus-lg me-2"></i>Legg til ny sondemat
                </button>

                <!-- Toalett / Quick Actions (Removed redundant buttons) -->
            </div>
            
            <!-- Medisindatabase Tab -->
            <div class="tab-pane fade" id="meddb" role="tabpanel">
                <!-- Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: linear-gradient(135deg, #009688 0%, #00796B 100%);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">Medisindatabase</h5>
                            <p class="mb-0 opacity-75 small">S√∏k opp informasjon om medisiner</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">üíä</span>
                        </div>
                    </div>
                </div>

                <!-- Search -->
                <div class="card border-0 shadow-sm rounded-4 p-4 mb-4">
                    <label for="medSearchInput" class="form-label fw-bold">S√∏k etter medisin</label>
                    <div class="input-group">
                        <input type="text" class="form-control form-control-lg" id="medSearchInput" placeholder="F.eks. Paracet, Ibux...">
                        <button class="btn btn-primary px-4" type="button" onclick="showMedicineInfo(document.getElementById('medSearchInput').value)">
                            <i class="bi bi-search me-2"></i>S√∏k
                        </button>
                    </div>
                    <div class="form-text mt-2">S√∏ker i lokal database og OpenFDA (med AI-oversettelse).</div>
                </div>

                <!-- Common Medicines List -->
                <h6 class="fw-bold mb-3 px-2">Vanlige medisiner</h6>
                <div class="d-flex flex-column gap-2 mb-4">
                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden" onclick="showMedicineInfo('Paracet')" style="cursor: pointer;">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                        <i class="bi bi-capsule fs-5"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold text-dark">Paracet</h6>
                                </div>
                                <i class="bi bi-chevron-right text-muted small"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden" onclick="showMedicineInfo('Ibux')" style="cursor: pointer;">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                        <i class="bi bi-capsule fs-5"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold text-dark">Ibux</h6>
                                </div>
                                <i class="bi bi-chevron-right text-muted small"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden" onclick="showMedicineInfo('Zyrtec')" style="cursor: pointer;">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                        <i class="bi bi-capsule fs-5"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold text-dark">Zyrtec</h6>
                                </div>
                                <i class="bi bi-chevron-right text-muted small"></i>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden" onclick="showMedicineInfo('Vitamin C')" style="cursor: pointer;">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                                        <i class="bi bi-flower1 fs-5"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold text-dark">Vitamin C</h6>
                                </div>
                                <i class="bi bi-chevron-right text-muted small"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ny Logg Tab -->
            <div class="tab-pane fade" id="log" role="tabpanel">
                <div class="text-center py-5">
                    <button type="button" class="btn btn-primary btn-lg rounded-pill shadow-lg px-5 py-3" data-bs-toggle="modal" data-bs-target="#logModal">
                        <span class="fs-4 d-block mb-1">‚ûï</span>
                        Legg til ny logg
                    </button>
                    <p class="text-muted mt-3">Trykk for √• registrere hendelser manuelt</p>
                </div>
                
                <!-- Modal for logging -->
                <div class="modal fade" id="logModal" tabindex="-1">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header text-white" style="background: var(--primary-gradient);">
                                <h5 class="modal-title">üìù Ny Logg</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="logForm">
                                    <div class="mb-3">
                                        <label for="type" class="form-label">Type *</label>
                                        <select class="form-select" id="type" required>
                                            <option value="">Velg type</option>
                                            <option value="Medisin">Medisin</option>
                                            <option value="Sondemat">Sondemat</option>
                                            <option value="Avf√∏ring">Avf√∏ring</option>
                                            <option value="vannlating">vannlating</option>
                                            <option value="Oppkast">Oppkast</option>
                                            <option value="Annet">Annet</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Navn felt (for Medisin/Sondemat/Annet) -->
                                    <div class="mb-3 hidden" id="nameField">
                                        <label for="name" class="form-label">Navn *</label>
                                        <select class="form-select" id="name">
                                            <option value="">Velg eller skriv</option>
                                            <!-- Populated dynamically by app.js -->
                                        </select>
                                        <input type="text" class="form-control mt-2 hidden" id="customName" placeholder="Skriv inn navn">
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="amountField">
                                        <label for="amount" class="form-label">Mengde/dose</label>
                                        <input type="number" step="0.01" class="form-control" id="amount">
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="unitField">
                                        <label for="unit" class="form-label">Enhet</label>
                                        <input type="text" class="form-control" id="unit" placeholder="f.eks. mg, ml, tablett">
                                    </div>
                                    
                                    <!-- Avf√∏ring-spesifikke felt -->
                                    <div class="mb-3 hidden" id="bmAmountField">
                                        <label for="bmAmount" class="form-label">Mengde avf√∏ring</label>
                                        <select class="form-select" id="bmAmount">
                                            <option value="Liten">Liten</option>
                                            <option value="Middels">Middels</option>
                                            <option value="Stor">Stor</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="bmConsistencyField">
                                        <label for="bmConsistency" class="form-label">Konsistens (Bristol Stool Scale)</label>
                                        <select class="form-select" id="bmConsistency">
                                            <option value="Type 1: Separate hard lumps, like nuts (hard to pass)">Type 1: Separate harde klumper (vanskelig)</option>
                                            <option value="Type 2: Sausage-shaped but lumpy">Type 2: P√∏lseformet men klumpete</option>
                                            <option value="Type 3: Like a sausage but with cracks on the surface">Type 3: Som p√∏lse med sprekker</option>
                                            <option value="Type 4: Like a sausage or snake, smooth and soft" selected>Type 4: P√∏lse/slange, glatt og myk (normal)</option>
                                            <option value="Type 5: Soft blobs with clear-cut edges">Type 5: Myke klumper med klare kanter</option>
                                            <option value="Type 6: Fluffy pieces with ragged edges, a mushy stool">Type 6: Fluffete biter, gr√∏tete</option>
                                            <option value="Type 7: Watery, no solid pieces, entirely liquid">Type 7: Vandig, helt flytende</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="bmColorField">
                                        <label for="bmColor" class="form-label">Farge</label>
                                        <input type="text" class="form-control" id="bmColor" placeholder="f.eks. Brun, Gr√∏nn, Blodig">
                                    </div>
                                    
                                    <!-- vannlating-spesifikke felt -->
                                    <div class="mb-3 hidden" id="urineAmountField">
                                        <label for="urineAmount" class="form-label">Mengde urin</label>
                                        <select class="form-select" id="urineAmount">
                                            <option value="Liten">Liten</option>
                                            <option value="Middels">Middels</option>
                                            <option value="Stor">Stor</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="urineColorField">
                                        <label for="urineColor" class="form-label">Farge</label>
                                        <select class="form-select" id="urineColor">
                                            <option value="Klar">Klar</option>
                                            <option value="Lys gul">Lys gul</option>
                                            <option value="M√∏rk gul">M√∏rk gul</option>
                                            <option value="R√∏dlig">R√∏dlig</option>
                                            <option value="Annet">Annet</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="urineSmellField">
                                        <label for="urineSmell" class="form-label">Lukt</label>
                                        <input type="text" class="form-control" id="urineSmell" placeholder="f.eks. Normal, Sterk">
                                    </div>

                                    <!-- Oppkast-spesifikke felt -->
                                    <div class="mb-3 hidden" id="vomitAmountField">
                                        <label for="vomitAmount" class="form-label">Mengde</label>
                                        <select class="form-select" id="vomitAmount">
                                            <option value="Liten">Liten (gulp)</option>
                                            <option value="Middels">Middels</option>
                                            <option value="Stor">Stor</option>
                                        </select>
                                    </div>

                                    <div class="mb-3 hidden" id="vomitColorField">
                                        <label for="vomitColor" class="form-label">Farge/Innhold</label>
                                        <input type="text" class="form-control" id="vomitColor" placeholder="f.eks. Uford√∏yd mat, slim, gult">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="time" class="form-label">Tidspunkt *</label>
                                        <input type="datetime-local" class="form-control" id="time" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="notes" class="form-label">Notater</label>
                                        <textarea class="form-control" id="notes" rows="2"></textarea>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Lagre logg</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dagens Logger Tab -->
            <div class="tab-pane fade" id="today" role="tabpanel">
                <div class="d-flex align-items-center justify-content-between mt-3 mb-3">
                    <h5 class="mb-0 fw-bold">üìÖ Dagens logger</h5>
                    <button class="btn btn-sm btn-primary rounded-pill fw-bold shadow-sm" onclick="document.getElementById('log-tab').click()">
                        ‚ûï Ny logg
                    </button>
                </div>
                <div id="todayTableBody" class="d-flex flex-column gap-2"></div>
                <div class="text-center mt-4 mb-5">
                    <p class="text-muted small">Viser kun logger fra i dag.<br>Se <strong>Historikk</strong> for eldre data.</p>
                </div>
            </div>
            
            <!-- Historikk Tab -->
            <div class="tab-pane fade" id="history" role="tabpanel">
                <div class="px-3 pt-4 pb-2 mb-3 d-flex justify-content-between align-items-end">
                    <div>
                        <div class="text-uppercase fw-bold text-muted small mb-1" style="letter-spacing: 0.5px;">Logg</div>
                        <h2 class="fw-bold text-dark mb-0" style="font-size: 2.2rem; letter-spacing: -0.02em;">Historikk</h2>
                    </div>
                    <button class="btn btn-light text-primary fw-bold shadow-sm rounded-pill px-3 border-0" onclick="exportToCSV()">
                        <i class="bi bi-download me-1"></i> CSV
                    </button>
                </div>
                
                <div class="card border-0 shadow-sm p-1 mb-4 rounded-4 bg-white overflow-hidden">
                    <div class="card-body p-2">
                        <div class="row g-2">
                            <div class="col-md-6">
                                <div class="input-group input-group-sm bg-light rounded-pill p-1 border">
                                    <span class="input-group-text bg-transparent border-0 text-muted ps-3"><i class="bi bi-calendar-event"></i></span>
                                    <input type="date" id="historyDate" class="form-control bg-transparent border-0 shadow-none text-muted fw-bold" style="font-size: 0.9rem;">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group input-group-sm bg-light rounded-pill p-1 border">
                                    <span class="input-group-text bg-transparent border-0 text-muted ps-3"><i class="bi bi-search"></i></span>
                                    <input type="text" id="search" class="form-control bg-transparent border-0 shadow-none text-muted" placeholder="S√∏k i logger..." style="font-size: 0.9rem;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="historyTableBody" class="d-flex flex-column gap-2"></div>
            </div>
            
            <!-- P√•minnelser Tab -->
            <div class="tab-pane fade" id="reminders" role="tabpanel">
                <!-- Premium Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: var(--secondary-gradient);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">P√•minnelser</h5>
                            <p class="mb-0 opacity-75 small">Administrer varsler og tider</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">‚è∞</span>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-end mb-3">
                    <button class="btn btn-light text-primary fw-bold bg-white shadow-sm rounded-pill px-3 border-0" onclick="scheduleReminders()">
                        <i class="bi bi-arrow-clockwise me-1"></i> Oppdater
                    </button>
                </div>
                
                <!-- Notifikasjons-status -->
                <div class="card border-0 shadow-sm mb-4 rounded-4 bg-light" id="notificationStatus">
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-white text-primary p-2 rounded-circle shadow-sm d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <i class="bi bi-bell-fill fs-5"></i>
                                </div>
                                <div>
                                    <div class="fw-bold text-dark small">Varslingsstatus</div>
                                    <div class="small text-muted" id="notificationStatusText">Sjekker...</div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-primary rounded-pill px-3 shadow-sm" id="enableNotificationsBtn" onclick="requestNotificationPermission()" style="display: none;">
                                Aktiver
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- iOS Installation guide -->
                <div class="card border-0 shadow-sm mb-4 bg-warning bg-opacity-10" id="iosGuide" style="display: none; border-radius: 20px;">
                    <div class="card-body p-4">
                        <div class="d-flex gap-3">
                            <div class="fs-1">üì±</div>
                            <div>
                                <h6 class="fw-bold text-dark">Oppsett for iPhone/iPad</h6>
                                <p class="small text-dark mb-0 opacity-75">
                                    For √• f√• p√•minnelser m√• du legge appen til p√• hjemskjermen:<br>
                                    1. Trykk p√• <strong>Del-knappen</strong> (‚ÜóÔ∏è) i Safari<br>
                                    2. Velg <strong>"Legg til p√• Hjem-skjerm"</strong><br>
                                    3. √Öpne appen fra hjemskjermen
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Legens plan -->
                <button class="btn btn-white w-100 border-0 shadow-sm rounded-4 mb-3 p-3 d-flex align-items-center justify-content-between text-start" onclick="addDoctorPlan()">
                    <div class="d-flex align-items-center gap-3">
                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <i class="bi bi-file-medical-fill fs-4"></i>
                        </div>
                        <div>
                            <div class="fw-bold text-dark">Legens plan</div>
                            <div class="small text-muted">Last inn standard tider fra sykehuset</div>
                        </div>
                    </div>
                    <i class="bi bi-cloud-download text-primary fs-5"></i>
                </button>
                
                <!-- Egen doseringsplan -->
                <div class="card border-0 shadow-sm rounded-4 mb-4">
                    <div class="card-header bg-white border-0 pt-3 pb-2 d-flex justify-content-between align-items-center rounded-top-4">
                        <h6 class="fw-bold mb-0 d-flex align-items-center gap-2">
                            <i class="bi bi-sliders text-primary"></i> Egen plan
                        </h6>
                        <button class="btn btn-sm btn-light text-primary fw-bold rounded-pill border-0 shadow-sm" onclick="showCustomPlanBuilder()">
                            <i class="bi bi-plus-lg me-1"></i> Ny
                        </button>
                    </div>
                    <div class="card-body pt-0">
                        <div id="customPlanList">
                            <div class="text-center py-4 text-muted small bg-light rounded-3 border border-light">
                                <i class="bi bi-calendar-x fs-4 d-block mb-2 opacity-50"></i>
                                Ingen egendefinerte planer enn√•
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Legg til ny p√•minnelse -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden bg-white">
                    <div class="card-body p-4">
                        <h6 class="fw-bold mb-3 d-flex align-items-center gap-2 text-dark">
                            <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-alarm-fill"></i>
                            </div>
                            Ny p√•minnelse
                        </h6>
                        <form id="reminderForm">
                            <div class="d-flex flex-column gap-3">
                                <input type="text" class="form-control form-control-lg bg-light border-0 text-dark shadow-none" 
                                       id="reminderName" 
                                       placeholder="Hva skal huskes?" 
                                       required>
                                <div class="row g-3">
                                    <div class="col-7">
                                        <div class="form-floating">
                                            <input type="time" class="form-control bg-light border-0 text-dark shadow-none" id="reminderTime" required placeholder="Tid">
                                            <label for="reminderTime" class="text-secondary">Tidspunkt</label>
                                        </div>
                                    </div>
                                    <div class="col-5 d-flex align-items-stretch">
                                        <button type="submit" class="btn btn-primary fw-bold w-100 shadow-sm rounded-3" style="border: none;">
                                            <i class="bi bi-plus-lg"></i> Legg til
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Liste over aktive p√•minnelser -->
                <div class="d-flex align-items-center justify-content-between mb-3 mt-4">
                    <h6 class="fw-bold mb-0 text-primary">
                        <i class="bi bi-bell me-2"></i>Aktive p√•minnelser
                    </h6>
                    <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill px-3" id="activeRemindersCount">
                        <!-- Count populated by JS -->
                    </span>
                </div>
                <div id="reminderList" class="d-flex flex-column gap-3"></div>
            </div>
            
            <!-- Statistikk Tab -->
            <div class="tab-pane fade" id="stats" role="tabpanel">
                <!-- Premium Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: var(--purple-gradient);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">Statistikk</h5>
                            <p class="mb-0 opacity-75 small">Oversikt og trender</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">üìä</span>
                        </div>
                    </div>
                </div>

                <!-- Date Filter -->
                <div class="card border-0 shadow-sm p-2 mb-4 rounded-4 bg-white overflow-hidden">
                    <div class="card-body p-2">
                        <div class="input-group input-group-sm bg-light rounded-pill p-1 border">
                            <span class="input-group-text bg-transparent border-0 text-muted ps-3"><i class="bi bi-calendar-range"></i></span>
                            <input type="date" id="statsDate" class="form-control bg-transparent border-0 shadow-none text-muted fw-bold" style="font-size: 0.9rem;">
                        </div>
                    </div>
                </div>
                
                <div id="statsContent" class="d-flex flex-column gap-3"></div>
            </div>
            
            <!-- Timers Tab -->
            <div class="tab-pane fade" id="timers" role="tabpanel">
                <!-- Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">Aktive Timere</h5>
                            <p class="mb-0 opacity-75 small">Infusjoner og tidsstyring</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">‚è±Ô∏è</span>
                        </div>
                    </div>
                </div>

                <!-- Active Timers List -->
                <div id="activeTimersList" class="d-flex flex-column gap-3 mb-4">
                    <!-- Injected by JS -->
                </div>

                <!-- Add Timer Button -->
                <button class="btn btn-primary w-100 rounded-pill fw-bold py-3 shadow-sm" style="background: var(--accent-gradient); border: none;" data-bs-toggle="modal" data-bs-target="#addTimerModal">
                    <i class="bi bi-plus-lg me-2"></i>Start ny timer
                </button>
            </div>

            <!-- SplTools Tab -->
            <div class="tab-pane fade" id="spltools" role="tabpanel">
                <!-- Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: linear-gradient(135deg, #FF5252 0%, #D32F2F 100%);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">SplTools</h5>
                            <p class="mb-0 opacity-75 small">Sykepleier-verkt√∏y</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">ü©∫</span>
                        </div>
                    </div>
                </div>

                <!-- Sub-tabs for SplTools features -->
                <ul class="nav nav-pills mb-4 nav-justified bg-light p-2 rounded-4" id="splToolsTabs" role="tablist" style="overflow-x: auto; flex-wrap: nowrap; gap: 4px;">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active rounded-pill fw-bold text-nowrap" id="dose-tab" data-bs-toggle="pill" data-bs-target="#spl-dose" type="button">Dosekalk</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link rounded-pill fw-bold text-nowrap" id="vitals-tab" data-bs-toggle="pill" data-bs-target="#spl-vitals" type="button">Vitaler</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link rounded-pill fw-bold text-nowrap" id="interactions-tab" data-bs-toggle="pill" data-bs-target="#spl-interactions" type="button" disabled>Interaksjon</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link rounded-pill fw-bold text-nowrap" id="trends-tab" data-bs-toggle="pill" data-bs-target="#spl-trends" type="button">Trender</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link rounded-pill fw-bold text-nowrap" id="scan-tab" data-bs-toggle="pill" data-bs-target="#spl-scan" type="button">Skann</button>
                    </li>
                </ul>

                <div class="tab-content">
                    <!-- Dosekalkulator -->
                    <div class="tab-pane fade show active" id="spl-dose" role="tabpanel">
                        <div class="card border-0 shadow-sm rounded-4 p-4">
                            <h6 class="fw-bold mb-3"><i class="bi bi-calculator me-2"></i>Dosekalkulator (mg/kg)</h6>
                            <form onsubmit="event.preventDefault(); window.splTools.calculateDose()">
                                <div class="row g-3 mb-3">
                                    <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Vekt (kg)</label>
                                        <input type="number" id="calc-weight" class="form-control" step="0.1" required>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Dose (mg/kg)</label>
                                        <input type="number" id="calc-dose-base" class="form-control" step="0.1" required>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label small text-muted text-uppercase fw-bold">Doseringstype</label>
                                    <div class="btn-group w-100" role="group">
                                        <input type="radio" class="btn-check" name="doseType" id="dosePerDay" value="per_day" checked>
                                        <label class="btn btn-outline-primary" for="dosePerDay">Total/d√∏gn</label>
                                        <input type="radio" class="btn-check" name="doseType" id="dosePerDose" value="per_dose">
                                        <label class="btn btn-outline-primary" for="dosePerDose">Per dose</label>
                                    </div>
                                </div>

                                <div class="row g-3 mb-3">
                                    <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Antall doser</label>
                                        <input type="number" id="calc-doses-per-day" class="form-control" value="1" min="1">
                                    </div>
                                     <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Kons. (mg/ml)</label>
                                        <input type="number" id="calc-concentration" class="form-control" step="0.1">
                                    </div>
                                </div>
                                 <div class="mb-3">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Maks d√∏gndose (mg)</label>
                                        <input type="number" id="calc-max-dose" class="form-control" step="0.1">
                                </div>

                                <button type="submit" class="btn btn-primary w-100 rounded-pill fw-bold mb-3">Beregn</button>
                            </form>

                            <div id="calc-results" class="hidden p-3 bg-light rounded-3 border">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Total d√∏gndose:</span>
                                    <span class="fw-bold" id="res-total-daily">-</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Per dose:</span>
                                    <span class="fw-bold fs-5 text-primary" id="res-per-dose">-</span>
                                </div>
                                 <div id="res-volume-container" class="d-flex justify-content-between mb-2 hidden">
                                    <span class="text-muted">Volum per dose:</span>
                                    <span class="fw-bold fs-5 text-success" id="res-volume">-</span>
                                </div>
                                <div id="calc-warning" class="text-danger small fw-bold mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Vitaler -->
                    <div class="tab-pane fade" id="spl-vitals" role="tabpanel">
                         <div class="card border-0 shadow-sm rounded-4 p-4">
                            <h6 class="fw-bold mb-3"><i class="bi bi-heart-pulse me-2"></i>Registrer Vitaler</h6>
                            <form id="vitals-form" onsubmit="event.preventDefault(); window.splTools.saveVitals()">
                                <div class="row g-3 mb-3">
                                    <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Sys (mmHg)</label>
                                        <input type="number" id="vital-sys" class="form-control" placeholder="120">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Dia (mmHg)</label>
                                        <input type="number" id="vital-dia" class="form-control" placeholder="80">
                                    </div>
                                </div>
                                <div class="row g-3 mb-3">
                                     <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">Puls (slag/min)</label>
                                        <input type="number" id="vital-pulse" class="form-control" placeholder="60">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small text-muted text-uppercase fw-bold">SpO2 (%)</label>
                                        <input type="number" id="vital-spo2" class="form-control" placeholder="98">
                                    </div>
                                </div>
                                <div class="mb-3">
                                     <label class="form-label small text-muted text-uppercase fw-bold">Temp (¬∞C)</label>
                                     <input type="number" id="vital-temp" class="form-control" step="0.1" placeholder="37.0">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small text-muted text-uppercase fw-bold">Knytt til medisin</label>
                                    <select id="vital-med-select" class="form-select">
                                        <option value="">-- Ingen --</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small text-muted text-uppercase fw-bold">Tidspunkt</label>
                                    <div class="btn-group w-100" role="group">
                                        <input type="radio" class="btn-check" name="vitalContext" id="ctx-none" value="none" checked>
                                        <label class="btn btn-outline-secondary" for="ctx-none">Generell</label>
                                        <input type="radio" class="btn-check" name="vitalContext" id="ctx-before" value="before">
                                        <label class="btn btn-outline-primary" for="ctx-before">F√∏r dose</label>
                                        <input type="radio" class="btn-check" name="vitalContext" id="ctx-after" value="after">
                                        <label class="btn btn-outline-primary" for="ctx-after">Etter dose</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small text-muted text-uppercase fw-bold">Notater</label>
                                    <textarea id="vital-notes" class="form-control" rows="2"></textarea>
                                </div>
                                <button type="submit" class="btn btn-success w-100 rounded-pill fw-bold text-white">Lagre Vitaler</button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Interaksjon -->
                    <div class="tab-pane fade" id="spl-interactions" role="tabpanel">
                        <div class="card border-0 shadow-sm rounded-4 p-4">
                            <h6 class="fw-bold mb-3"><i class="bi bi-exclamation-triangle me-2"></i>Interaksjonssjekk</h6>
                            <p class="text-muted small mb-3">Sjekker aktive medisiner mot database for kjente interaksjoner.</p>
                            
                            <div id="active-meds-list" class="mb-3 d-flex flex-wrap gap-2">
                                <!-- Injected via JS -->
                                <span class="badge bg-light text-secondary border">Laster medisiner...</span>
                            </div>

                            <button onclick="window.splTools.checkInteractions()" class="btn btn-warning w-100 rounded-pill fw-bold text-dark mb-3">
                                <i class="bi bi-search me-2"></i>Kj√∏r analyse
                            </button>

                            <div id="interaction-results" class="d-flex flex-column gap-2">
                                <!-- Results injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- Trender -->
                    <div class="tab-pane fade" id="spl-trends" role="tabpanel">
                        <div class="card border-0 shadow-sm rounded-4 p-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-bold mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Trend-analyse</h6>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle rounded-pill" type="button" data-bs-toggle="dropdown">
                                        7 dager
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0 rounded-3">
                                        <li><a class="dropdown-item active" href="#" onclick="window.splTools.updateTrendPeriod(7, this)">7 dager</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="window.splTools.updateTrendPeriod(14, this)">14 dager</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="window.splTools.updateTrendPeriod(30, this)">30 dager</a></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="btn-group w-100 mb-4" role="group">
                                <input type="radio" class="btn-check" name="trendType" id="trendMeds" autocomplete="off" checked onchange="window.splTools.updateTrendType('meds')">
                                <label class="btn btn-outline-primary" for="trendMeds">Medisiner</label>
                                <input type="radio" class="btn-check" name="trendType" id="trendVitals" autocomplete="off" onchange="window.splTools.updateTrendType('vitals')">
                                <label class="btn btn-outline-primary" for="trendVitals">Vitaler</label>
                            </div>

                            <div id="trend-chart-container" class="w-100 mb-3 d-flex align-items-end justify-content-center" style="height: 200px; background: rgba(0,0,0,0.02); border-radius: 12px;">
                                <!-- SVG Chart injected here -->
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Laster...</span>
                                </div>
                            </div>

                            <div class="row text-center g-2" id="trend-stats">
                                <!-- Stats injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- Skann -->
                    <div class="tab-pane fade" id="spl-scan" role="tabpanel">
                        <style>
                            /* Force Quagga video to fill container */
                            #scanner-container video, 
                            #scanner-container canvas,
                            #scanner-container .drawingBuffer {
                                width: 100% !important;
                                height: 100% !important;
                                object-fit: cover !important;
                                position: absolute !important;
                                top: 0 !important;
                                left: 0 !important;
                            }
                        </style>
                        <div id="scanner-container" class="card border-0 shadow-sm rounded-4 overflow-hidden position-relative" style="height: 55vh; max-height: 500px; background: #000;">
                            <!-- Placeholder for Quagga -->
                            
                            <!-- Analysis Loading Indicator -->
                            <div id="scan-loading" class="position-absolute top-50 start-50 translate-middle text-white text-center d-none" style="z-index: 30;">
                                <div class="spinner-border mb-2" role="status" style="width: 3rem; height: 3rem;"></div>
                                <div class="fw-bold text-shadow">Analyserer...</div>
                            </div>

                            <!-- Overlay -->
                            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-between p-4" style="z-index: 10; pointer-events: none;">
                                <div class="w-100 text-center text-white mt-4">
                                    <div class="border border-2 border-white rounded-3 mx-auto" style="width: 250px; height: 150px; box-shadow: 0 0 0 1000px rgba(0,0,0,0.5);"></div>
                                    <p class="mt-3 text-shadow">Plasser medisineske i ruten</p>
                                </div>
                                
                                <button class="btn btn-light rounded-circle shadow-lg d-flex align-items-center justify-content-center mb-4" 
                                        style="width: 70px; height: 70px; border: 4px solid rgba(255,255,255,0.5); pointer-events: auto;"
                                        onclick="window.splTools.captureImage()">
                                    <div class="bg-dark rounded-circle" style="width: 50px; height: 50px;"></div>
                                </button>
                            </div>


                            <!-- Result Card -->
                            <div id="scan-result" class="position-absolute bottom-0 start-0 w-100 p-3 hidden" style="z-index: 20;">
                                <div class="card border-0 shadow-lg rounded-4">
                                    <div class="card-body p-3">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div>
                                                <span class="badge bg-success mb-1">Funnet</span>
                                                <h5 class="fw-bold mb-0" id="scan-match-name">Navn</h5>
                                                <small class="text-muted" id="scan-match-type">-</small>
                                            </div>
                                            <button class="btn-close" onclick="document.getElementById('scan-result').classList.add('hidden')"></button>
                                        </div>
                                        <p class="small text-muted mb-3">Sjekket mot Felleskatalogen/FDA (Mock)</p>
                                        <button class="btn btn-primary w-100 rounded-pill fw-bold" onclick="window.splTools.addScannedMed()">
                                            <i class="bi bi-plus-lg me-2"></i>Legg til i liste
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add Timer Modal -->
        <div class="modal fade" id="addTimerModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg rounded-4">
                    <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); border-radius: 24px 24px 0 0;">
                        <h5 class="modal-title fw-bold"><i class="bi bi-stopwatch me-2"></i>Ny Timer</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <!-- Presets Section -->
                        <div class="mb-4">
                            <label class="form-label fw-bold text-secondary small text-uppercase">Hurtigvalg / Maler</label>
                            <div id="presetList" class="d-flex flex-wrap gap-1">
                                <!-- Injected by JS -->
                            </div>
                        </div>

                        <form id="newTimerForm" onsubmit="event.preventDefault(); createTimer(document.getElementById('timerName').value, document.getElementById('timerMinutes').value, document.getElementById('timerVolume').value, document.getElementById('alarmBeforeRange').value, document.getElementById('saveAsPreset').checked)">
                            <div class="mb-3">
                                <label for="timerName" class="form-label fw-bold">Navn p√• timer *</label>
                                <input type="text" class="form-control form-control-lg bg-light border-0" id="timerName" required placeholder="F.eks. Antibiotika">
                            </div>
                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label for="timerMinutes" class="form-label fw-bold">Tid (min) *</label>
                                    <input type="number" class="form-control form-control-lg bg-light border-0" id="timerMinutes" required min="1" placeholder="30">
                                </div>
                                <div class="col-6 mb-3">
                                    <label for="timerVolume" class="form-label fw-bold">Volum (ml)</label>
                                    <input type="number" class="form-control form-control-lg bg-light border-0" id="timerVolume" min="0" placeholder="100">
                                </div>
                            </div>
                            
                            <!-- Alarm Before -->
                            <div class="card border-0 bg-light p-3 rounded-4 mb-4">
                                <label for="alarmBeforeRange" class="form-label fw-bold d-flex justify-content-between">
                                    <span>Varsle f√∏r slutt</span>
                                    <span class="text-primary" id="alarmBeforeValue">0 min</span>
                                </label>
                                <input type="range" class="form-range" id="alarmBeforeRange" min="0" max="30" step="1" value="0" oninput="document.getElementById('alarmBeforeValue').textContent = this.value + ' min'">
                                <div class="form-text small mt-0">Dra for √• sette varsel f√∏r tiden er ute (0 = av)</div>
                            </div>

                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="saveAsPreset">
                                <label class="form-check-label" for="saveAsPreset">
                                    Lagre som mal for senere bruk
                                </label>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg rounded-pill shadow-sm fw-bold" style="background: var(--accent-gradient); border: none;">
                                    Start timer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal fade" id="settingsModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg rounded-4">
                    <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #607D8B, #455A64); border-radius: 24px 24px 0 0;">
                        <h5 class="modal-title fw-bold"><i class="bi bi-gear-fill me-2"></i>Innstillinger</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <h6 class="fw-bold text-secondary text-uppercase small mb-3">Utseende</h6>
                        <div class="card border-0 shadow-sm p-3 rounded-4 mb-4 bg-light">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-dark text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-moon-stars-fill"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">M√∏rk modus</div>
                                        <div class="small text-muted">Bytt mellom lyst og m√∏rkt tema</div>
                                    </div>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="darkModeToggle" style="width: 3em; height: 1.5em; cursor: pointer;">
                                </div>
                            </div>
                        </div>

                        <h6 class="fw-bold text-secondary text-uppercase small mb-3">Data & Eksport</h6>
                        <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 mb-3 d-flex align-items-center justify-content-between" onclick="exportToCSV()">
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <i class="bi bi-file-earmark-spreadsheet fs-5"></i>
                                </div>
                                <div>
                                    <div class="fw-bold text-dark">Eksporter til CSV</div>
                                    <div class="small text-muted">Last ned alle data til Excel</div>
                                </div>
                            </div>
                            <i class="bi bi-download text-secondary"></i>
                        </button>

                        <hr class="my-4 opacity-10">

                        <h6 class="fw-bold text-secondary text-uppercase small mb-3">System & Varsler</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 d-flex align-items-center justify-content-between" onclick="sendTestPushNotification()">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-bell fs-5"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">Test Push-varsel</div>
                                        <div class="small text-muted">Send en testmelding</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-right text-secondary"></i>
                            </button>
                            
                            <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 d-flex align-items-center justify-content-between" onclick="fetchPushStatus()">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-info bg-opacity-10 text-info rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-info-circle fs-5"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">Status Push-tjeneste</div>
                                        <div class="small text-muted">Sjekk tilkobling</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-right text-secondary"></i>
                            </button>

                            <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 d-flex align-items-center justify-content-between" onclick="sendTestDailyReport()">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-envelope fs-5"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">Test E-postrapport</div>
                                        <div class="small text-muted">Send daglig rapport n√•</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-right text-secondary"></i>
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer border-0 px-4 pb-4 pt-0">
                        <button type="button" class="btn btn-secondary w-100 rounded-pill py-2 fw-bold" data-bs-dismiss="modal">Lukk</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Bowel Movement Modal -->
    <div class="modal fade" id="bowelModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #795548, #5D4037); border-radius: 24px 24px 0 0;">
                    <h5 class="modal-title fw-bold"><i class="bi bi-chat-square-text me-2"></i>Logg avf√∏ring</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Mengde</label>
                        <select class="form-select form-select-lg shadow-sm border-0 bg-light" id="quickBmAmount">
                            <option value="Liten">Liten</option>
                            <option value="Middels" selected>Middels</option>
                            <option value="Stor">Stor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Konsistens</label>
                        <select class="form-select shadow-sm border-0 bg-light" id="quickBmConsistency" style="padding-top: 12px; padding-bottom: 12px;">
                            <option value="Type 1: Separate hard lumps, like nuts (hard to pass)">Type 1: Harde klumper</option>
                            <option value="Type 2: Sausage-shaped but lumpy">Type 2: P√∏lseformet men klumpete</option>
                            <option value="Type 3: Like a sausage but with cracks on the surface">Type 3: P√∏lse med sprekker</option>
                            <option value="Type 4: Like a sausage or snake, smooth and soft" selected>Type 4: Normal (glatt og myk)</option>
                            <option value="Type 5: Soft blobs with clear-cut edges">Type 5: Myke klumper</option>
                            <option value="Type 6: Fluffy pieces with ragged edges, a mushy stool">Type 6: Gr√∏tete</option>
                            <option value="Type 7: Watery, no solid pieces, entirely liquid">Type 7: Vandig/diar√©</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Farge (valgfritt)</label>
                        <input type="text" class="form-control shadow-sm border-0 bg-light" id="quickBmColor" placeholder="f.eks. Brun, Gr√∏nn">
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <button type="button" class="btn btn-light text-muted fw-bold px-4 rounded-pill" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white fw-bold px-5 rounded-pill shadow-sm flex-grow-1" style="background: linear-gradient(135deg, #795548, #5D4037);" onclick="submitQuickBowelMovement()">
                        <i class="bi bi-check-lg me-1"></i> Lagre
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick vannlating Modal -->
    <div class="modal fade" id="vannlatingModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #039BE5, #0277BD); border-radius: 24px 24px 0 0;">
                    <h5 class="modal-title fw-bold"><i class="bi bi-droplet-fill me-2"></i>Logg vannlating</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Mengde</label>
                        <select class="form-select form-select-lg shadow-sm border-0 bg-light" id="quickUrineAmount">
                            <option value="Liten">Liten</option>
                            <option value="Middels" selected>Middels</option>
                            <option value="Stor">Stor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Farge</label>
                        <select class="form-select shadow-sm border-0 bg-light" id="quickUrineColor" style="padding-top: 12px; padding-bottom: 12px;">
                            <option value="Klar">Klar</option>
                            <option value="Lys gul" selected>Lys gul</option>
                            <option value="M√∏rk gul">M√∏rk gul</option>
                            <option value="R√∏dlig">R√∏dlig</option>
                            <option value="Annet">Annet</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Lukt (valgfritt)</label>
                        <input type="text" class="form-control shadow-sm border-0 bg-light" id="quickUrineSmell" placeholder="f.eks. Normal, Sterk">
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <button type="button" class="btn btn-light text-muted fw-bold px-4 rounded-pill" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white fw-bold px-5 rounded-pill shadow-sm flex-grow-1" style="background: linear-gradient(135deg, #039BE5, #0277BD);" onclick="submitQuickvannlating()">
                        <i class="bi bi-check-lg me-1"></i> Lagre
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
                <div class="modal-header border-0 text-white p-4" style="background: var(--primary-gradient);">
                    <div class="text-center w-100">
                        <img src="./logo.svg" alt="Dosevakt" style="height: 50px; margin-bottom: 10px; filter: brightness(0) invert(1);">
                        <h5 class="modal-title fw-bold">Velkommen</h5>
                        <p class="mb-0 opacity-75 small">Logg inn for √• bruke Dosevakt</p>
                    </div>
                </div>
                <div class="modal-body p-4 bg-light">
                    <button class="btn btn-white w-100 py-3 rounded-4 shadow-sm fw-bold mb-3 d-flex align-items-center justify-content-center gap-2" 
                            onclick="loginWithGoogle()">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="24" height="24" alt="Google">
                        Logg inn med Google
                    </button>
                    
                    <div class="d-flex align-items-center my-3">
                        <hr class="flex-grow-1">
                        <span class="mx-2 text-muted small">ELLER</span>
                        <hr class="flex-grow-1">
                    </div>

                    <form onsubmit="event.preventDefault(); loginWithEmail(this.email.value, this.password.value).catch(e => alert(e.message))">
                        <div class="mb-3">
                            <input type="email" name="email" class="form-control rounded-4 py-2" placeholder="E-post" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" name="password" class="form-control rounded-4 py-2" placeholder="Passord" required>
                        </div>
                        <button type="submit" class="btn text-white w-100 rounded-4 py-2 fw-bold" style="background: var(--primary-gradient);">Logg inn</button>
                    </form>
                    
                    <div class="text-center mt-3">
                         <a href="#" class="small text-decoration-none" data-bs-toggle="modal" data-bs-target="#registerModal">Ny bruker? Registrer deg her</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
             <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
                <div class="modal-header border-0 bg-success text-white p-4">
                    <div>
                        <h5 class="modal-title fw-bold">Registrer bruker</h5>
                    </div>
                     <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4 bg-light">
                    <form onsubmit="event.preventDefault(); registerWithEmail(this.email.value, this.password.value, this.name.value).then(() => { const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal')); if(modal) modal.hide(); }).catch(e => alert(e.message))">
                        <div class="mb-3">
                            <input type="text" name="name" class="form-control rounded-4 py-2" placeholder="Navn (vises i logger)" required>
                        </div>
                        <div class="mb-3">
                            <input type="email" name="email" class="form-control rounded-4 py-2" placeholder="E-post" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" name="password" class="form-control rounded-4 py-2" placeholder="Passord" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100 rounded-4 py-2 fw-bold">Registrer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-white" style="background: var(--primary-gradient);">
                    <h5 class="modal-title">üë§ <span id="addUserModalTitle">Ny bruker</span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editingUserId">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Navn *</label>
                        <input type="text" id="newUserName" class="form-control" placeholder="Ditt navn">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">E-post (valgfritt)</label>
                        <input type="email" id="newUserEmail" class="form-control" placeholder="din@epost.no">
                        <div class="form-text">For √• motta daglig rapport og varsler</div>
                    </div>
                    
                    <div class="bg-light p-3 rounded-3 mb-3">
                        <h6 class="fw-bold mb-3">üìß E-postvarsler</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="newUserDailyReport">
                            <label class="form-check-label" for="newUserDailyReport">
                                <div>Daglig rapport</div>
                                <small class="text-muted">Motta oppsummering kl. 22:00</small>
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="newUserMissedMedAlert">
                            <label class="form-check-label" for="newUserMissedMedAlert">
                                <div>Glemt medisin-varsel</div>
                                <small class="text-muted">Varsles hvis medisin ikke er gitt 10 min etter tidspunkt</small>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAddUserModal()">Avbryt</button>
                    <button type="button" class="btn text-white" style="background: var(--primary-gradient);" onclick="saveUser()">Lagre</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Vomit Modal -->
    <div class="modal fade" id="vomitModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #E53935, #C62828); border-radius: 24px 24px 0 0;">
                    <h5 class="modal-title fw-bold"><i class="bi bi-exclamation-triangle-fill me-2"></i>Logg oppkast</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Mengde</label>
                        <select class="form-select form-select-lg shadow-sm border-0 bg-light" id="quickVomitAmount">
                            <option value="Liten">Liten (gulp)</option>
                            <option value="Middels" selected>Middels</option>
                            <option value="Stor">Stor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Farge/Innhold</label>
                        <input type="text" class="form-control shadow-sm border-0 bg-light" id="quickVomitColor" placeholder="f.eks. Uford√∏yd mat, slim, gult">
                    </div>
                    <div class="mb-2">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Tidspunkt</label>
                        <input type="datetime-local" class="form-control shadow-sm border-0 bg-light" id="quickVomitTime">
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <button type="button" class="btn btn-light text-muted fw-bold px-4 rounded-pill" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white fw-bold px-5 rounded-pill shadow-sm flex-grow-1" style="background: linear-gradient(135deg, #E53935, #C62828);" onclick="quickLogVomit()">
                        <i class="bi bi-check-lg me-1"></i> Logg oppkast
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Medicine to Checklist Modal -->
    <div class="modal fade" id="addMedicineModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-white" style="background: var(--primary-gradient);">
                    <h5 class="modal-title">üíä Legg til ny medisin</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3 position-relative">
                  <label class="form-label fw-bold">Medisinnavn *</label>
                  <input type="text" class="form-control" id="newMedicineName" placeholder="F.eks. Marevan" required autocomplete="off">
                  <div id="medicineSuggestions" class="list-group position-absolute w-100 shadow" style="display: none; max-height: 200px; overflow-y: auto; z-index: 1050; top: 100%;"></div>
                </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Dose/mengde</label>
                        <input type="text" class="form-control" id="newMedicineDose" placeholder="F.eks. 10 ml, 1 tablett">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Kategori *</label>
                        <div class="d-grid gap-2" style="grid-template-columns: 1fr 1fr;">
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="dag" class="form-check-input mt-0">
                                <span>üåÖ Morgen</span>
                            </label>
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="kveld" class="form-check-input mt-0">
                                <span>üåô Kveld</span>
                            </label>
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="both" class="form-check-input mt-0">
                                <span>üîÑ Begge</span>
                            </label>
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="prn" checked class="form-check-input mt-0">
                                <span>üéØ Ved behov</span>
                            </label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Dager</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="medicineDaysType" id="daysEveryday" value="everyday" checked onchange="document.getElementById('specificDaysContainer').style.display = 'none'">
                            <label class="form-check-label" for="daysEveryday">
                                Hver dag
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="medicineDaysType" id="daysSpecific" value="specific" onchange="document.getElementById('specificDaysContainer').style.display = 'block'">
                            <label class="form-check-label" for="daysSpecific">
                                Spesifikke dager
                            </label>
                        </div>
                        
                        <div id="specificDaysContainer" class="mt-2" style="display: none;">
                            <div class="d-flex flex-wrap gap-2">
                                <input type="checkbox" class="btn-check" id="day-1" value="1" autocomplete="off">
                                <label class="btn btn-outline-primary btn-sm" for="day-1">Man</label>
                                
                                <input type="checkbox" class="btn-check" id="day-2" value="2" autocomplete="off">
                                <label class="btn btn-outline-primary btn-sm" for="day-2">Tir</label>
                                
                                <input type="checkbox" class="btn-check" id="day-3" value="3" autocomplete="off">
                                <label class="btn btn-outline-primary btn-sm" for="day-3">Ons</label>
                                
                                <input type="checkbox" class="btn-check" id="day-4" value="4" autocomplete="off">
                                <label class="btn btn-outline-primary btn-sm" for="day-4">Tor</label>
                                
                                <input type="checkbox" class="btn-check" id="day-5" value="5" autocomplete="off">
                                <label class="btn btn-outline-primary btn-sm" for="day-5">Fre</label>
                                
                                <input type="checkbox" class="btn-check" id="day-6" value="6" autocomplete="off">
                                <label class="btn btn-outline-primary btn-sm" for="day-6">L√∏r</label>
                                
                                <input type="checkbox" class="btn-check" id="day-0" value="0" autocomplete="off">
                                <label class="btn btn-outline-primary btn-sm" for="day-0">S√∏n</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                            <label class="form-label fw-bold">Tidspunkt (valgfritt)</label>
                            <input type="time" class="form-control" id="newMedicineTime">
                            <small class="text-muted">Legg til klokkeslett hvis medisinen skal tas til fast tid</small>
                        </div>

                        <!-- Lagerstyring -->
                        <div class="mb-3 p-3 bg-light rounded border">
                            <h6 class="fw-bold mb-3"><i class="bi bi-box-seam me-2"></i>Lagerstyring</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label small">N√•v√¶rende beholdning</label>
                                    <input type="number" class="form-control" id="newMedicineStock" placeholder="Antall" min="0">
                                </div>
                                <div class="col-6">
                                    <label class="form-label small">Varsle ved antall</label>
                                    <input type="number" class="form-control" id="newMedicineThreshold" placeholder="F.eks 10" min="0">
                                </div>
                            </div>
                            <small class="text-muted d-block mt-2">Appen teller ned automatisk n√•r du haker av medisiner.</small>
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn btn-success" onclick="addNewMedicineToChecklist()" style="padding: 12px 24px;">
                        ‚úì Legg til
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Sondemat to Checklist Modal -->
    <div class="modal fade" id="addSondematModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-white" style="background: linear-gradient(135deg, #42A5F5, #2196F3);">
                    <h5 class="modal-title">üçº Legg til ny sondemat</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="newSondematName" class="form-label fw-bold">Sondematenavn *</label>
                        <input type="text" class="form-control" id="newSondematName" placeholder="F.eks. Fresubin" required>
                    </div>
                    <div class="mb-3">
                        <label for="newSondematAmount" class="form-label fw-bold">Mengde</label>
                        <input type="text" class="form-control" id="newSondematAmount" placeholder="F.eks. 500 ml">
                    </div>
                    <div class="mb-3">
                        <label for="newSondematFrequency" class="form-label fw-bold">Frekvens</label>
                        <input type="text" class="form-control" id="newSondematFrequency" placeholder="F.eks. 3x daglig">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white" style="background: linear-gradient(135deg, #42A5F5, #2196F3);" onclick="addNewSondematToChecklist()">
                        üíæ Lagre
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom Plan Builder Modal -->
    <div class="modal fade" id="customPlanModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚öôÔ∏è Lag egen doseringsplan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="customPlanName" class="form-label">Navn p√• plan *</label>
                        <input type="text" class="form-control" id="customPlanName" placeholder="F.eks. Mari sin morgenrutine" required>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">Velg medisiner og tidspunkter:</h6>
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="addCustomMedicineField()">
                            ‚ûï Legg til ny medisin
                        </button>
                    </div>
                    <div id="medicineTimePicker" style="max-height: 400px; overflow-y: auto;">
                        <!-- Generated dynamically -->
                    </div>
                    <div id="customMedicineContainer" class="mt-3">
                        <!-- Custom medicines will be added here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomPlan()">
                        üíæ Lagre plan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- What's New Modal -->
    <div class="modal fade" id="whatsNewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header text-white" style="background: linear-gradient(135deg, #2196F3, #1976D2);">
                    <h5 class="modal-title">‚ú® Nytt i Dosevakt</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <h5 class="mb-3">Hei! üëã</h5>
                    <p>Vi har oppdatert Dosevakt med <strong>SplTools</strong> og <strong>Timere</strong>!</p>
                    
                    <div class="d-flex align-items-center mb-3 p-3 rounded-3" style="background: #FFEBEE;">
                        <i class="bi bi-heart-pulse-fill text-danger fs-1 me-3"></i>
                        <div>
                            <strong>SplTools (Sykepleierverkt√∏y)</strong>
                            <div class="small text-muted">Dosekalkulator, Vitaler, Trender og Skanner.</div>
                        </div>
                    </div>

                    <div class="d-flex align-items-center mb-3 p-3 rounded-3" style="background: #FFF3E0;">
                        <i class="bi bi-stopwatch-fill text-warning fs-1 me-3"></i>
                        <div>
                            <strong>Timer-funksjon</strong>
                            <div class="small text-muted">Sett alarmer for infusjoner og sjekkpunkter.</div>
                        </div>
                    </div>

                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>Skanner:</strong> Ta bilde av medisinesker for oppslag.</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>Dosekalk:</strong> Beregn mg/kg enkelt.</li>
                        <li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i><strong>Vitaler:</strong> Loggf√∏r BT, Puls, Temp raskt.</li>
                    </ul>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-primary w-100 rounded-pill py-2" data-bs-dismiss="modal">
                        Skj√∏nner! üëç
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Offcanvas Menu -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel" style="border-radius: 0 20px 20px 0; border: none; box-shadow: 5px 0 30px rgba(0,0,0,0.1);">
        <div class="offcanvas-header" style="background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); color: white; padding: 24px;">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel" style="display: flex; align-items: center; gap: 16px; font-weight: 700; font-size: 1.5rem;">
                <img src="./logo.svg" alt="Logo" style="height: 40px; filter: brightness(0) invert(1);">
                Dosevakt
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body" style="padding: 0;">
            <!-- User Profile Section -->
            <div style="text-align: center; padding: 32px 20px; background: #f8f9fa; border-bottom: 1px solid #eee;">
                <div style="width: 88px; height: 88px; background: white; border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 3rem; box-shadow: 0 8px 24px rgba(0,0,0,0.08);">
                    üë§
                </div>
                <h4 id="offcanvasUserName" style="margin-bottom: 4px; font-weight: 700; color: #333;">Bruker</h4>
                <p style="color: #666; font-size: 0.95rem; margin-bottom: 24px;">Innlogget bruker</p>
                <button onclick="switchUser()" class="btn btn-outline-primary rounded-pill px-4 py-2" data-bs-dismiss="offcanvas" style="font-weight: 600;">
                    <i class="bi bi-arrow-repeat me-2"></i>Bytt bruker
                </button>
            </div>

            <!-- Patient Selector Section -->
            <div class="px-3 pb-3 mb-2 border-bottom mt-3">
                <label class="small text-muted fw-bold text-uppercase mb-2">Pasient</label>
                <button class="btn btn-light w-100 d-flex align-items-center justify-content-between p-3 rounded-4 border" onclick="showPatientSelectorModal(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div class="d-flex align-items-center gap-3">
                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                            <i class="bi bi-person-heart fs-5"></i>
                        </div>
                        <div class="text-start">
                            <div class="fw-bold text-dark" id="currentPatientNameMenu">Velg pasient</div>
                            <div class="small text-muted" id="currentPatientRoleMenu">Klikk for √• bytte</div>
                        </div>
                    </div>
                    <i class="bi bi-chevron-right text-muted"></i>
                </button>
            </div>

            <!-- Menu Items -->
            <div class="list-group list-group-flush p-3 gap-2">
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('home-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E3F2FD; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #2196F3; font-size: 1.2rem;">
                        <i class="bi bi-house-door-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Hjem</span>
                </button>
                
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('checklist-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E8F5E9; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #4CAF50; font-size: 1.2rem;">
                        <i class="bi bi-check-square-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Sjekkliste</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('meddb-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E0F2F1; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #009688; font-size: 1.2rem;">
                        <i class="bi bi-capsule"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Medisindatabase</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('log-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #FFF3E0; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #FF9800; font-size: 1.2rem;">
                        <i class="bi bi-plus-circle-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Ny Logg</span>
                </button>
                
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('today-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #FFF8E1; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #FFC107; font-size: 1.2rem;">
                        <i class="bi bi-calendar-event-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">I dag</span>
                </button>
                
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('history-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #F3E5F5; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #9C27B0; font-size: 1.2rem;">
                        <i class="bi bi-clock-history"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Historikk</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('reminders-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E0F7FA; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #00BCD4; font-size: 1.2rem;">
                        <i class="bi bi-bell-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">P√•minnelser</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('spltools-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #FFEBEE; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #D32F2F; font-size: 1.2rem;">
                        <i class="bi bi-activity"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">SplTools</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('spltools-tab').click(); setTimeout(() => document.getElementById('scan-tab').click(), 200); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E8F5E9; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #2E7D32; font-size: 1.2rem;">
                        <i class="bi bi-upc-scan"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Medisinscanner</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('timers-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E3F2FD; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #2196F3; font-size: 1.2rem;">
                        <i class="bi bi-stopwatch-fill"></i>
                    </div>
                    <div class="d-flex justify-content-between align-items-center flex-grow-1">
                        <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Timere</span>
                        <span class="badge bg-primary rounded-pill" id="menuTimersBadge" style="display: none;"></span>
                    </div>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('stats-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E8EAF6; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #3F51B5; font-size: 1.2rem;">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Statistikk</span>
                </button>
                
                <div class="border-top my-2"></div>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#settingsModal" onclick="bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #F5F5F5; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #616161; font-size: 1.2rem;">
                        <i class="bi bi-gear-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Innstillinger</span>
                </button>
            </div>
            
            <div style="margin-top: auto; padding: 24px; text-align: center;">
                <p style="color: #ccc; font-size: 0.8rem; margin: 0; font-weight: 500;">Dosevakt v1.2.0</p>
            </div>
        </div>
    </div>
    
            <!-- Journal Folder Modal -->
            <div class="modal fade" id="journalFolderModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-sm">
                    <div class="modal-content bg-transparent border-0 shadow-none">
                        <div class="modal-body p-4 rounded-5" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px);">
                            <h5 class="text-center mb-4 fw-bold">Journal</h5>
                            <div class="folder-grid">
                                <button onclick="document.getElementById('today-tab').click(); bootstrap.Modal.getInstance(document.getElementById('journalFolderModal')).hide();" class="app-icon-card">
                                    <div class="app-icon bg-gradient-blue">
                                        <i class="bi bi-calendar-event"></i>
                                    </div>
                                    <div class="app-label">I dag</div>
                                </button>
                                <button onclick="document.getElementById('history-tab').click(); bootstrap.Modal.getInstance(document.getElementById('journalFolderModal')).hide();" class="app-icon-card">
                                    <div class="app-icon bg-gradient-purple">
                                        <i class="bi bi-clock-history"></i>
                                    </div>
                                    <div class="app-label">Historikk</div>
                                </button>
                                <!-- Statistikk tab not implemented yet, using history/today -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tools Folder Modal -->
            <div class="modal fade" id="toolsFolderModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-sm">
                    <div class="modal-content bg-transparent border-0 shadow-none">
                        <div class="modal-body p-4 rounded-5" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px);">
                            <h5 class="text-center mb-4 fw-bold">Verkt√∏y</h5>
                            <div class="folder-grid">
                                <button onclick="document.getElementById('spltools-tab').click(); bootstrap.Modal.getInstance(document.getElementById('toolsFolderModal')).hide();" class="app-icon-card">
                                    <div class="app-icon bg-gradient-red">
                                        <i class="bi bi-briefcase-medical"></i>
                                    </div>
                                    <div class="app-label">SplTools</div>
                                </button>
                                <button onclick="document.getElementById('timers-tab').click(); bootstrap.Modal.getInstance(document.getElementById('toolsFolderModal')).hide();" class="app-icon-card">
                                    <div class="app-icon bg-gradient-orange">
                                        <i class="bi bi-stopwatch"></i>
                                    </div>
                                    <div class="app-label">Timere</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    
    <!-- Patient Selector Modal -->
    <div class="modal fade" id="patientSelectorModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-5 border-0 shadow-lg">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Velg Pasient</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="patientListContainer" class="d-flex flex-column gap-2 mb-4">
                        <!-- Patients injected here -->
                        <div class="text-center py-3">
                            <div class="spinner-border text-primary" role="status"></div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline-primary w-100 rounded-pill py-3 fw-bold border-2 border-dashed" onclick="showCreatePatientModal()">
                        <i class="bi bi-plus-lg me-2"></i>Legg til ny pasient
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Patient Selector Modal -->
    <div class="modal fade" id="patientSelectorModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-5 border-0 shadow-lg">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Velg Pasient</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="patientListContainer" class="p-3">
                        <!-- Populated by JS -->
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary"></div>
                        </div>
                    </div>
                    <div class="p-3 bg-light border-top rounded-bottom-5">
                        <button class="btn btn-outline-primary w-100 rounded-pill py-3 fw-bold border-2 border-dashed" onclick="showCreatePatientModal()">
                            <i class="bi bi-plus-lg me-2"></i>Legg til ny pasient
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Patient Modal (Static placeholder, replaced by JS) -->
    <div class="modal fade" id="createPatientModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-5 border-0 shadow-lg">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Ny Pasient</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createPatientForm" onsubmit="event.preventDefault(); createNewPatient();">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Navn</label>
                            <input type="text" id="newPatientName" class="form-control form-control-lg rounded-4" required placeholder="F.eks. Jens">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">F√∏dselsdato (valgfritt)</label>
                            <input type="date" id="newPatientDob" class="form-control rounded-4">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">Sykdomsbilde / Beskrivelse</label>
                            <textarea id="newPatientDescription" class="form-control rounded-4" rows="3" placeholder="Kort beskrivelse av diagnose og behov..."></textarea>
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary rounded-pill py-3 fw-bold shadow-sm">
                                Opprett Pasient
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

            <!-- Background Settings Modal -->
            <div class="modal fade" id="bgSettingsModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content rounded-5 border-0 shadow-lg">
                        <div class="modal-header border-0 pb-0">
                            <h5 class="modal-title fw-bold">üé® Tilpass Bakgrunn</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Upload Section -->
                            <div class="card border-0 bg-light rounded-4 mb-4">
                                <div class="card-body p-3">
                                    <h6 class="fw-bold mb-2"><i class="bi bi-upload me-2"></i>Last opp eget bilde</h6>
                                    <input type="file" id="bg-upload-input" class="form-control mb-2" accept="image/*">
                                    <div class="form-text small">Bildet lagres lokalt i nettleseren din.</div>
                                </div>
                            </div>
                            
                            <!-- Opacity Slider -->
                            <div class="card border-0 bg-light rounded-4 mb-4">
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="fw-bold mb-0"><i class="bi bi-brightness-high me-2"></i>Synlighet</h6>
                                        <span id="bg-opacity-value" class="badge bg-white text-dark shadow-sm">85%</span>
                                    </div>
                                    <input type="range" class="form-range" id="bg-opacity-slider" min="0" max="100" value="85">
                                    <div class="d-flex justify-content-between small text-muted">
                                        <span>Klar</span>
                                        <span>Dempet</span>
                                    </div>
                                </div>
                            </div>

                            <hr class="my-3 opacity-25">

                            <!-- Library Section -->
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-bold mb-0"><i class="bi bi-collection me-2"></i>Velg fra bibliotek</h6>
                                <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="BackgroundService.resetBackground()">
                                    <i class="bi bi-trash me-1"></i>Tilbakestill
                                </button>
                            </div>
                            
                            <div id="bgLibraryGrid">
                                <!-- Populated by JS -->
                                <div class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
    
    <!-- Statistics Modal -->
    <div class="modal fade" id="statisticsModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content bg-light">
                <div class="modal-header border-0 bg-white shadow-sm">
                    <h5 class="modal-title fw-bold"><i class="bi bi-activity me-2 text-danger"></i>Helseoversikt</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Navigation Tabs -->
                    <ul class="nav nav-pills nav-fill p-3 bg-white border-bottom" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active rounded-pill fw-bold" data-bs-toggle="tab" data-bs-target="#stats-overview">
                                <i class="bi bi-graph-up me-2"></i>Oversikt
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link rounded-pill fw-bold" data-bs-toggle="tab" data-bs-target="#stats-log">
                                <i class="bi bi-journal-plus me-2"></i>Loggf√∏ring
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link rounded-pill fw-bold" data-bs-toggle="tab" data-bs-target="#stats-inventory">
                                <i class="bi bi-box-seam me-2"></i>Lager
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content p-3 pb-5">
                        <!-- Overview Tab -->
                        <div class="tab-pane fade show active" id="stats-overview">
                            <!-- Temperature Chart -->
                            <div class="card border-0 shadow-sm rounded-4 mb-3">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3"><i class="bi bi-thermometer-half text-danger me-2"></i>Temperatur</h6>
                                    <canvas id="tempChart" height="200"></canvas>
                                </div>
                            </div>

                            <!-- Events Chart (Vomit/Stool) -->
                            <div class="card border-0 shadow-sm rounded-4 mb-3">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3"><i class="bi bi-bar-chart-fill text-primary me-2"></i>Hendelser (Siste 7 dager)</h6>
                                    <canvas id="eventsChart" height="200"></canvas>
                                </div>
                            </div>

                            <!-- Diary Feed -->
                            <h6 class="fw-bold ms-1 mb-2 text-muted">DAGBOK</h6>
                            <div id="diary-feed" class="d-flex flex-column gap-3">
                                <!-- Diary entries will be injected here -->
                            </div>
                        </div>

                        <!-- Logging Tab -->
                        <div class="tab-pane fade" id="stats-log">
                            <!-- Temperature Log -->
                            <div class="card border-0 shadow-sm rounded-4 mb-3">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3"><i class="bi bi-thermometer-half text-danger me-2"></i>Registrer Temperatur</h6>
                                    <div class="input-group input-group-lg mb-3">
                                        <input type="number" id="new-temp-input" class="form-control" placeholder="37.5" step="0.1">
                                        <span class="input-group-text">¬∞C</span>
                                    </div>
                                    <button class="btn btn-danger w-100 rounded-pill py-3 fw-bold" onclick="Statistics.logTemperature()">
                                        <i class="bi bi-check-lg me-2"></i>Lagre Temperatur
                                    </button>
                                </div>
                            </div>

                            <!-- Diary Entry -->
                            <div class="card border-0 shadow-sm rounded-4 mb-3">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3"><i class="bi bi-journal-text text-primary me-2"></i>Dagens Notat</h6>
                                    <textarea id="new-diary-input" class="form-control mb-3" rows="4" placeholder="Hvordan er formen? Spesielle hendelser?"></textarea>
                                    <button class="btn btn-primary w-100 rounded-pill py-3 fw-bold" onclick="Statistics.logDiary()">
                                        <i class="bi bi-check-lg me-2"></i>Lagre Notat
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Inventory Tab -->
                        <div class="tab-pane fade" id="stats-inventory">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-bold mb-0 text-muted">BEHOLDNING</h6>
                                <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="Statistics.renderInventory()">
                                    <i class="bi bi-arrow-clockwise"></i>
                                </button>
                            </div>
                            <div id="inventory-list" class="d-flex flex-column gap-2">
                                <!-- Inventory items injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Config -->
    <script src="firebase-config.js?v=51"></script>

    <!-- App Config -->
    <script src="config.js?v=51"></script>
    
    <!-- Medicine Info -->
    <script src="medicine-info.js?v=51"></script>
    
    <!-- Utils (Helper functions) -->
    <script src="utils.js?v=54"></script>

    <!-- Data Management -->
    <script src="data.js?v=54"></script>

    <!-- UI Rendering -->
    <script src="ui.js?v=54"></script>
    
    <!-- Background Service -->
    <script src="background-service.js?v=54"></script>

    <!-- Patient Management -->
    <script src="patient-manager.js?v=54"></script>

    <!-- App JS -->
    <script src="app.js?v=54"></script>
    
    <!-- Dosing Plan JS -->
    <script src="dosing-plan.js?v=54"></script>
    
    <!-- Timers JS -->
    <script src="timers.js?v=51"></script>
    
    <!-- QuaggaJS for Barcode Scanning -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>

    <!-- Tesseract.js for Text Recognition -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <!-- Chart.js for Health Statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

    <!-- SplTools JS -->
    <script src="spl-tools.js?v=47"></script>
    
    <!-- Statistics JS -->
    <script src="statistics.js?v=47"></script>
    
    <!-- Service Worker Cleanup -->
    <script>
        // Unregister conflicting service workers to fix reload loops and caching issues
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                for (let registration of registrations) {
                    // Check if this is the caching service worker (sw.js)
                    // We want to keep firebase-messaging-sw.js for push notifications
                    const scriptUrl = (registration.active && registration.active.scriptURL) ||
                                    (registration.waiting && registration.waiting.scriptURL) ||
                                    (registration.installing && registration.installing.scriptURL) ||
                                    '';
                    
                    if (scriptUrl.includes('/sw.js')) {
                        console.log('Unregistering conflicting service worker:', scriptUrl);
                        registration.unregister()
                            .then(success => console.log('Service Worker unregistered:', success))
                            .catch(error => console.error('Service Worker unregister failed:', error));
                    }
                }
            });
        }

        window.addEventListener('load', () => {
            if (typeof initializeFirebase === 'function') {
                initializeFirebase();
            }
        });
    </script>
    
    <!-- Bottom Navigation -->
    <nav style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); box-shadow: 0 -1px 20px rgba(0,0,0,0.08); z-index: 1020; padding: 8px 0 max(8px, env(safe-area-inset-bottom));">
        <div style="display: flex; justify-content: space-around; align-items: center; max-width: 500px; margin: 0 auto;">
            <button type="button" onclick="document.getElementById('checklist-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-clipboard-check" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">Sjekk</span>
            </button>
            <button type="button" onclick="document.getElementById('today-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-calendar-day" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">I dag</span>
            </button>
            <button type="button" onclick="document.getElementById('home-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 0; display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                <div style="background: linear-gradient(135deg, #2196F3, #64B5F6); width: 52px; height: 52px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(33,150,243,0.4); margin-top: -20px;">
                    <i class="bi bi-house-door-fill" style="font-size: 1.5rem; color: white;"></i>
                </div>
            </button>
            <button type="button" onclick="document.getElementById('reminders-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-bell" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">P√•minn</span>
            </button>
            <button type="button" onclick="document.getElementById('history-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-clock-history" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">Historikk</span>
            </button>
        </div>
    </nav>
</body>
</html>

