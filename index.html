<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dosevakt - Medisin & Omsorgslogg</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#FFFFFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Dosevakt">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png">
    
    <!-- iOS/Apple ikoner -->
    <link rel="apple-touch-icon" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="167x167" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./apple-touch-icon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root {
            /* Color Palette - Premium & Modern */
            --bs-primary: #4CAF50;
            --bs-secondary: #2196F3;
            --bs-body-bg: #F5F7FA;
            
            /* Enhanced Gradients */
            --primary-gradient: linear-gradient(135deg, #4CAF50 0%, #43A047 100%);
            --secondary-gradient: linear-gradient(135deg, #2196F3 0%, #1E88E5 100%);
            --accent-gradient: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            --purple-gradient: linear-gradient(135deg, #9C27B0 0%, #8E24AA 100%);
            
            /* Surfaces */
            --bg-card: #FFFFFF;
            --bg-glass: rgba(255, 255, 255, 0.95);
            
            /* Text */
            --text-primary: #1A1A1A;
            --text-secondary: #6c757d;
            
            /* Borders & Shadows */
            --border-color: #EAEAEA;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
            --shadow-lg: 0 16px 48px rgba(0,0,0,0.12);
            --shadow-hover: 0 12px 32px rgba(0,0,0,0.12);
            
            /* Accents */
            --accent-green: #4CAF50;
            --accent-blue: #2196F3;
            --accent-orange: #FF9800;
            --accent-purple: #9C27B0;
            --accent-teal: #00BCD4;
            --accent-pink: #E91E63;
        }
        
        body { 
            padding-top: 160px; /* Adjusted for larger header */
            padding-bottom: calc(100px + env(safe-area-inset-bottom));
            background-color: var(--bs-body-bg);
            color: var(--text-primary);
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }
        
        /* Premium Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            background: #FFFFFF; /* Solid white background to prevent flickering */
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            border-bottom: 1px solid rgba(0,0,0,0.03);
            height: 140px; /* Increased height */
            /* Removed transition to prevent repaints */
        }

        .header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Animation removed to prevent flickering */

        .header-logo img {
            height: 120px; /* Increased logo size */
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05));
            /* Animation removed */
        }
        
        /* Log Cards */
        .log-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }
        
        .log-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .menu-btn {
            color: var(--text-primary);
            font-size: 1.8rem;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: none;
            background: transparent;
            transition: all 0.2s ease;
        }
        
        .menu-btn:active {
            background-color: rgba(0,0,0,0.05);
            transform: scale(0.95);
        }

        /* Container & Cards */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
        }
        
        /* Buttons */
        .btn {
            border-radius: 12px;
            padding: 10px 20px;
            font-weight: 600;
            letter-spacing: 0.3px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .btn-primary {
            background: var(--primary-gradient);
            border: none;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
            background: var(--primary-gradient); /* Keep gradient */
        }
        
        /* Dashboard/Home Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 24px;
        }
        
        .dashboard-card {
            border: none;
            border-radius: 24px;
            padding: 24px 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 160px;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .dashboard-card:active {
            transform: scale(0.98);
        }
        
        .dashboard-card .icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }
        
        .dashboard-card .title {
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dashboard-card .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Quick Actions */
        .quick-actions {
            margin-top: 32px;
            background: var(--bg-card);
            border-radius: 24px;
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .quick-action-grid {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            flex: 1;
            min-width: 100px;
            background: #F8F9FA;
            border: 1px solid transparent;
            border-radius: 16px;
            padding: 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .quick-btn:hover {
            background: #FFFFFF;
            border-color: var(--border-color);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        /* Tabs */
        .nav-tabs {
            border-bottom: none;
            background: var(--bg-card);
            padding: 12px 12px 0;
            border-radius: 24px 24px 0 0;
            gap: 8px;
            flex-wrap: nowrap;
            overflow-x: auto;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        
        .nav-tabs::-webkit-scrollbar {
            display: none; /* Hide scrollbar Chrome/Safari */
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 50px; /* Pill shape */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            white-space: nowrap;
            background: #F5F7FA;
        }
        
        .nav-tabs .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.25);
            transform: translateY(-1px);
        }

        /* Inputs & Forms */
        .form-control, .form-select {
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            background-color: #FAFAFA;
            transition: all 0.2s ease;
        }
        
        .form-control:focus, .form-select:focus {
            background-color: #FFFFFF;
            border-color: var(--bs-primary);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.1);
        }

        /* Splash Screen CSS Removed */

        /* Modals */
        .modal-content {
            border: none;
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 24px 24px 16px;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            border-top: none;
            padding: 0 24px 24px;
        }
        
        .modal-title {
            font-weight: 700;
        }

        /* Accordion Premium */
        .accordion-item {
            border: none;
            border-radius: 16px !important;
            margin-bottom: 12px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            background: var(--bg-card);
        }
        
        .accordion-button {
            border-radius: 16px !important;
            font-weight: 600;
            padding: 16px 20px;
            background: transparent;
            box-shadow: none !important;
        }
        
        .accordion-button:not(.collapsed) {
            background: rgba(76, 175, 80, 0.05);
            color: var(--bs-primary);
        }

        /* Lists */
        .list-group-item {
            border: none;
            border-bottom: 1px solid var(--border-color);
            padding: 16px;
        }
        
        .list-group-item:last-child {
            border-bottom: none;
        }

        /* Mobile Optimization */
        @media (max-width: 576px) {
            .container { padding: 0 16px; }
            .dashboard-card { padding: 20px 16px; min-height: 140px; }
            .dashboard-card .icon { font-size: 2rem; }
            .dashboard-card .title { font-size: 1rem; }
            .nav-tabs .nav-link { padding: 10px 14px; font-size: 0.9rem; }
            h1 { font-size: 1.75rem; }
            h2 { font-size: 1.3rem; }
        }

        /* Utility */
        .hidden { display: none !important; }
        .text-muted { color: var(--text-secondary) !important; }

        /* Dark Mode Overrides */
        body.dark-mode {
            --bs-body-bg: #121212;
            --bg-card: #1E1E1E;
            --bg-glass: rgba(30, 30, 30, 0.95);
            --text-primary: #E0E0E0;
            --text-secondary: #B0B0B0;
            --border-color: #333333;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.2);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.3);
            --shadow-lg: 0 16px 48px rgba(0,0,0,0.4);
            --shadow-hover: 0 12px 32px rgba(0,0,0,0.4);
        }

        body.dark-mode .app-header {
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        body.dark-mode .nav-tabs .nav-link {
            background: #2C2C2C;
            color: #B0B0B0;
        }

        body.dark-mode .nav-tabs .nav-link.active {
            color: white;
        }

        body.dark-mode .card, 
        body.dark-mode .dashboard-card,
        body.dark-mode .quick-actions,
        body.dark-mode .list-group-item,
        body.dark-mode .offcanvas {
            background: var(--bg-card);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        body.dark-mode .form-control,
        body.dark-mode .form-select {
            background-color: #2C2C2C;
            border-color: #444;
            color: #E0E0E0;
        }

        body.dark-mode .modal-content {
            background-color: #1E1E1E;
            border-color: #333;
            color: var(--text-primary);
        }

        body.dark-mode .text-dark {
            color: #E0E0E0 !important;
        }

        body.dark-mode .text-muted {
            color: #9aa0a6 !important;
        }

        body.dark-mode .bg-light {
            background-color: #2C2C2C !important;
        }

        body.dark-mode .bg-white {
            background-color: #1E1E1E !important;
        }

        body.dark-mode .header-logo img {
            filter: brightness(0) invert(1);
        }
        
        body.dark-mode .offcanvas-header {
             border-bottom: 1px solid #333;
        }
        
        body.dark-mode .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
    </style>
</head>
<body>
    <!-- Sticky Header -->
    <header class="app-header">
        <div class="header-inner">
            <button class="menu-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar">
                <i class="bi bi-list" style="font-size: 2.5rem;"></i>
            </button>
            <div class="header-logo mx-auto">
                <a href="#" onclick="document.getElementById('home-tab').click(); return false;">
                    <img src="./logo.svg" alt="Dosevakt">
                </a>
            </div>
            <div style="width: 48px;"></div> <!-- Spacer for visual balance -->
        </div>
    </header>
    
    <!-- Splash Screen Removed -->
    
    <div class="container">
        <!-- Tabs (Hidden - Controlled via Hamburger Menu) -->
        <ul class="nav nav-tabs d-none" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button">üè† Hjem</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="checklist-tab" data-bs-toggle="tab" data-bs-target="#checklist" type="button">Sjekkliste</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="log-tab" data-bs-toggle="tab" data-bs-target="#log" type="button">Ny Logg</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="today-tab" data-bs-toggle="tab" data-bs-target="#today" type="button">I dag</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button">Historikk</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reminders-tab" data-bs-toggle="tab" data-bs-target="#reminders" type="button">P√•minnelser</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button">Statistikk</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="timers-tab" data-bs-toggle="tab" data-bs-target="#timers" type="button">Timere</button>
            </li>
        </ul>
        
        <div class="tab-content">
            <!-- Hjem Tab -->
            <div class="tab-pane fade show active" id="home" role="tabpanel">
                <div style="text-align: center; padding: 12px 20px 16px;">
                    <h2 style="font-size: 2rem; font-weight: 800; color: var(--text-primary); margin-bottom: 8px; letter-spacing: -0.5px;">Hei, <span id="welcomeUserName" style="color: var(--bs-primary); background: linear-gradient(120deg, var(--bs-primary), var(--bs-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">der</span>!</h2>
                    <p style="color: var(--text-secondary); font-size: 1.2rem; margin: 0; font-weight: 500;">Klar for √• ta vare p√• Jens</p>
                </div>
                
                <div class="dashboard-grid">
                    <button onclick="document.getElementById('checklist-tab').click()" class="dashboard-card" style="background: var(--primary-gradient);">
                        <div class="icon">üíä</div>
                        <div class="title">Sjekkliste</div>
                        <div class="subtitle">Daglige medisiner</div>
                    </button>
                    <button onclick="document.getElementById('reminders-tab').click()" class="dashboard-card" style="background: var(--secondary-gradient);">
                        <div class="icon">‚è∞</div>
                        <div class="title">P√•minnelser</div>
                        <div class="subtitle">Se varsler</div>
                    </button>
                    <button onclick="document.getElementById('today-tab').click()" class="dashboard-card" style="background: var(--accent-gradient);">
                        <div class="icon">üìÖ</div>
                        <div class="title">I dag</div>
                        <div class="subtitle">Dagens logger</div>
                    </button>
                    <button onclick="document.getElementById('history-tab').click()" class="dashboard-card" style="background: var(--purple-gradient);">
                        <div class="icon">üìä</div>
                        <div class="title">Historikk</div>
                        <div class="subtitle">Alle logger</div>
                    </button>
                    <button onclick="document.getElementById('timers-tab').click()" class="dashboard-card" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                        <div class="icon">‚è∞</div>
                        <div class="title">Timere</div>
                        <div class="subtitle">Infusjon & tid</div>
                    </button>
                </div>
                
                <div class="quick-actions">
                    <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 16px; font-size: 1rem;">Hurtigvalg</div>
                    <div class="quick-action-grid">
                        <button onclick="document.getElementById('checklist-tab').click()" class="quick-btn">
                            <div style="font-size: 1.8rem;">üíä</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px; font-weight: 500;">Medisin</div>
                        </button>
                        <button data-bs-toggle="modal" data-bs-target="#bowelModal" class="quick-btn">
                            <div style="font-size: 1.8rem;">üí©</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px; font-weight: 500;">Avf√∏ring</div>
                        </button>
                        <button data-bs-toggle="modal" data-bs-target="#vannlatingModal" class="quick-btn">
                            <div style="font-size: 1.8rem;">üíß</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px; font-weight: 500;">Vannlating</div>
                        </button>
                        <button data-bs-toggle="modal" data-bs-target="#vomitModal" class="quick-btn">
                            <div style="font-size: 1.8rem;">ü§Æ</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px; font-weight: 500;">Oppkast</div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sjekkliste Tab -->
            <div class="tab-pane fade" id="checklist" role="tabpanel">
                <!-- Premium Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: var(--primary-gradient);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">Daglig Sjekkliste</h5>
                            <p class="mb-0 opacity-75 small">Oversikt over dagens gj√∏rem√•l</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">üìù</span>
                        </div>
                    </div>
                </div>
                
                <!-- Medicine Checklist Container -->
                <div id="medicineChecklist" class="d-flex flex-column gap-3 pb-3">
                    <!-- Content injected by app.js -->
                </div>
                
                <!-- Add Medicine Button -->
                <button class="btn btn-outline-primary w-100 mb-4 rounded-pill fw-bold py-3 border-2 dashed-border" data-bs-toggle="modal" data-bs-target="#addMedicineModal">
                    <i class="bi bi-plus-lg me-2"></i>Legg til ny medisin
                </button>

                <!-- Sondemat Header & List -->
                <div class="d-flex align-items-center mb-3 mt-4">
                    <div class="bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                        <i class="bi bi-droplet-fill"></i>
                    </div>
                    <h6 class="text-uppercase text-muted fw-bold mb-0" style="font-size: 0.8rem; letter-spacing: 0.5px;">Sondemat</h6>
                </div>
                
                <div id="sondeChecklist" class="d-flex flex-column gap-3 pb-3">
                     <!-- Content injected by app.js -->
                </div>
                
                <button class="btn btn-outline-warning w-100 mb-4 rounded-pill fw-bold py-3 border-2 dashed-border text-dark" data-bs-toggle="modal" data-bs-target="#addSondematModal">
                    <i class="bi bi-plus-lg me-2"></i>Legg til ny sondemat
                </button>

                <!-- Toalett / Quick Actions -->
                <div class="d-flex align-items-center mb-3 mt-4">
                    <div class="bg-info bg-opacity-10 text-info rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                        <i class="bi bi-water"></i>
                    </div>
                    <h6 class="text-uppercase text-muted fw-bold mb-0" style="font-size: 0.8rem; letter-spacing: 0.5px;">Toalett</h6>
                </div>
                
                <div class="row g-3 mb-5">
                    <div class="col-4">
                        <button class="btn btn-white border-0 shadow-sm p-3 rounded-4 w-100 h-100 d-flex flex-column align-items-center justify-content-center gap-2 quick-action-btn transition-transform" data-bs-toggle="modal" data-bs-target="#bowelModal">
                            <span style="font-size: 2rem;">üí©</span>
                            <span class="fw-bold text-dark small">Avf√∏ring</span>
                        </button>
                    </div>
                    <div class="col-4">
                        <button class="btn btn-white border-0 shadow-sm p-3 rounded-4 w-100 h-100 d-flex flex-column align-items-center justify-content-center gap-2 quick-action-btn transition-transform" data-bs-toggle="modal" data-bs-target="#vannlatingModal">
                            <span style="font-size: 2rem;">üíß</span>
                            <span class="fw-bold text-dark small">Vannlating</span>
                        </button>
                    </div>
                    <div class="col-4">
                         <button class="btn btn-white border-0 shadow-sm p-3 rounded-4 w-100 h-100 d-flex flex-column align-items-center justify-content-center gap-2 quick-action-btn transition-transform" data-bs-toggle="modal" data-bs-target="#vomitModal">
                            <span style="font-size: 2rem;">ü§Æ</span>
                            <span class="fw-bold text-danger small">Oppkast</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Ny Logg Tab -->
            <div class="tab-pane fade" id="log" role="tabpanel">
                <div class="text-center py-5">
                    <button type="button" class="btn btn-primary btn-lg rounded-pill shadow-lg px-5 py-3" data-bs-toggle="modal" data-bs-target="#logModal">
                        <span class="fs-4 d-block mb-1">‚ûï</span>
                        Legg til ny logg
                    </button>
                    <p class="text-muted mt-3">Trykk for √• registrere hendelser manuelt</p>
                </div>
                
                <!-- Modal for logging -->
                <div class="modal fade" id="logModal" tabindex="-1">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header text-white" style="background: var(--primary-gradient);">
                                <h5 class="modal-title">üìù Ny Logg</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="logForm">
                                    <div class="mb-3">
                                        <label for="type" class="form-label">Type *</label>
                                        <select class="form-select" id="type" required>
                                            <option value="">Velg type</option>
                                            <option value="Medisin">Medisin</option>
                                            <option value="Sondemat">Sondemat</option>
                                            <option value="Avf√∏ring">Avf√∏ring</option>
                                            <option value="vannlating">vannlating</option>
                                            <option value="Oppkast">Oppkast</option>
                                            <option value="Annet">Annet</option>
                                        </select>
                                    </div>
                                    
                                    <!-- Navn felt (for Medisin/Sondemat/Annet) -->
                                    <div class="mb-3 hidden" id="nameField">
                                        <label for="name" class="form-label">Navn *</label>
                                        <select class="form-select" id="name">
                                            <option value="">Velg eller skriv</option>
                                            <!-- Populated dynamically by app.js -->
                                        </select>
                                        <input type="text" class="form-control mt-2 hidden" id="customName" placeholder="Skriv inn navn">
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="amountField">
                                        <label for="amount" class="form-label">Mengde/dose</label>
                                        <input type="number" step="0.01" class="form-control" id="amount">
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="unitField">
                                        <label for="unit" class="form-label">Enhet</label>
                                        <input type="text" class="form-control" id="unit" placeholder="f.eks. mg, ml, tablett">
                                    </div>
                                    
                                    <!-- Avf√∏ring-spesifikke felt -->
                                    <div class="mb-3 hidden" id="bmAmountField">
                                        <label for="bmAmount" class="form-label">Mengde avf√∏ring</label>
                                        <select class="form-select" id="bmAmount">
                                            <option value="Liten">Liten</option>
                                            <option value="Middels">Middels</option>
                                            <option value="Stor">Stor</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="bmConsistencyField">
                                        <label for="bmConsistency" class="form-label">Konsistens (Bristol Stool Scale)</label>
                                        <select class="form-select" id="bmConsistency">
                                            <option value="Type 1: Separate hard lumps, like nuts (hard to pass)">Type 1: Separate harde klumper (vanskelig)</option>
                                            <option value="Type 2: Sausage-shaped but lumpy">Type 2: P√∏lseformet men klumpete</option>
                                            <option value="Type 3: Like a sausage but with cracks on the surface">Type 3: Som p√∏lse med sprekker</option>
                                            <option value="Type 4: Like a sausage or snake, smooth and soft" selected>Type 4: P√∏lse/slange, glatt og myk (normal)</option>
                                            <option value="Type 5: Soft blobs with clear-cut edges">Type 5: Myke klumper med klare kanter</option>
                                            <option value="Type 6: Fluffy pieces with ragged edges, a mushy stool">Type 6: Fluffete biter, gr√∏tete</option>
                                            <option value="Type 7: Watery, no solid pieces, entirely liquid">Type 7: Vandig, helt flytende</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="bmColorField">
                                        <label for="bmColor" class="form-label">Farge</label>
                                        <input type="text" class="form-control" id="bmColor" placeholder="f.eks. Brun, Gr√∏nn, Blodig">
                                    </div>
                                    
                                    <!-- vannlating-spesifikke felt -->
                                    <div class="mb-3 hidden" id="urineAmountField">
                                        <label for="urineAmount" class="form-label">Mengde urin</label>
                                        <select class="form-select" id="urineAmount">
                                            <option value="Liten">Liten</option>
                                            <option value="Middels">Middels</option>
                                            <option value="Stor">Stor</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="urineColorField">
                                        <label for="urineColor" class="form-label">Farge</label>
                                        <select class="form-select" id="urineColor">
                                            <option value="Klar">Klar</option>
                                            <option value="Lys gul">Lys gul</option>
                                            <option value="M√∏rk gul">M√∏rk gul</option>
                                            <option value="R√∏dlig">R√∏dlig</option>
                                            <option value="Annet">Annet</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3 hidden" id="urineSmellField">
                                        <label for="urineSmell" class="form-label">Lukt</label>
                                        <input type="text" class="form-control" id="urineSmell" placeholder="f.eks. Normal, Sterk">
                                    </div>

                                    <!-- Oppkast-spesifikke felt -->
                                    <div class="mb-3 hidden" id="vomitAmountField">
                                        <label for="vomitAmount" class="form-label">Mengde</label>
                                        <select class="form-select" id="vomitAmount">
                                            <option value="Liten">Liten (gulp)</option>
                                            <option value="Middels">Middels</option>
                                            <option value="Stor">Stor</option>
                                        </select>
                                    </div>

                                    <div class="mb-3 hidden" id="vomitColorField">
                                        <label for="vomitColor" class="form-label">Farge/Innhold</label>
                                        <input type="text" class="form-control" id="vomitColor" placeholder="f.eks. Uford√∏yd mat, slim, gult">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="time" class="form-label">Tidspunkt *</label>
                                        <input type="datetime-local" class="form-control" id="time" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="notes" class="form-label">Notater</label>
                                        <textarea class="form-control" id="notes" rows="2"></textarea>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">Lagre logg</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dagens Logger Tab -->
            <div class="tab-pane fade" id="today" role="tabpanel">
                <div class="d-flex align-items-center justify-content-between mt-3 mb-3">
                    <h5 class="mb-0 fw-bold">üìÖ Dagens logger</h5>
                    <button class="btn btn-sm btn-primary rounded-pill fw-bold shadow-sm" onclick="document.getElementById('log-tab').click()">
                        ‚ûï Ny logg
                    </button>
                </div>
                <div id="todayTableBody" class="d-flex flex-column gap-2"></div>
                <div class="text-center mt-4 mb-5">
                    <p class="text-muted small">Viser kun logger fra i dag.<br>Se <strong>Historikk</strong> for eldre data.</p>
                </div>
            </div>
            
            <!-- Historikk Tab -->
            <div class="tab-pane fade" id="history" role="tabpanel">
                <div class="d-flex align-items-center justify-content-between mt-4 mb-3">
                    <h5 class="mb-0 fw-bold text-dark">Historikk</h5>
                    <button class="btn btn-sm btn-white text-primary fw-bold shadow-sm rounded-pill px-3 border-0" onclick="exportToCSV()">
                        <i class="bi bi-download me-1"></i> CSV
                    </button>
                </div>
                
                <div class="card border-0 shadow-sm p-1 mb-4 rounded-4 bg-white overflow-hidden">
                    <div class="card-body p-2">
                        <div class="row g-2">
                            <div class="col-md-6">
                                <div class="input-group input-group-sm bg-light rounded-pill p-1 border">
                                    <span class="input-group-text bg-transparent border-0 text-muted ps-3"><i class="bi bi-calendar-event"></i></span>
                                    <input type="date" id="historyDate" class="form-control bg-transparent border-0 shadow-none text-muted fw-bold" style="font-size: 0.9rem;">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group input-group-sm bg-light rounded-pill p-1 border">
                                    <span class="input-group-text bg-transparent border-0 text-muted ps-3"><i class="bi bi-search"></i></span>
                                    <input type="text" id="search" class="form-control bg-transparent border-0 shadow-none text-muted" placeholder="S√∏k i logger..." style="font-size: 0.9rem;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="historyTableBody" class="d-flex flex-column gap-2"></div>
            </div>
            
            <!-- P√•minnelser Tab -->
            <div class="tab-pane fade" id="reminders" role="tabpanel">
                <!-- Premium Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: var(--secondary-gradient);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">P√•minnelser</h5>
                            <p class="mb-0 opacity-75 small">Administrer varsler og tider</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">‚è∞</span>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-end mb-3">
                    <button class="btn btn-light text-primary fw-bold bg-white shadow-sm rounded-pill px-3 border-0" onclick="scheduleReminders()">
                        <i class="bi bi-arrow-clockwise me-1"></i> Oppdater
                    </button>
                </div>
                
                <!-- Notifikasjons-status -->
                <div class="card border-0 shadow-sm mb-4 rounded-4 bg-light" id="notificationStatus">
                    <div class="card-body p-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-white text-primary p-2 rounded-circle shadow-sm d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <i class="bi bi-bell-fill fs-5"></i>
                                </div>
                                <div>
                                    <div class="fw-bold text-dark small">Varslingsstatus</div>
                                    <div class="small text-muted" id="notificationStatusText">Sjekker...</div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-primary rounded-pill px-3 shadow-sm" id="enableNotificationsBtn" onclick="requestNotificationPermission()" style="display: none;">
                                Aktiver
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- iOS Installation guide -->
                <div class="card border-0 shadow-sm mb-4 bg-warning bg-opacity-10" id="iosGuide" style="display: none; border-radius: 20px;">
                    <div class="card-body p-4">
                        <div class="d-flex gap-3">
                            <div class="fs-1">üì±</div>
                            <div>
                                <h6 class="fw-bold text-dark">Oppsett for iPhone/iPad</h6>
                                <p class="small text-dark mb-0 opacity-75">
                                    For √• f√• p√•minnelser m√• du legge appen til p√• hjemskjermen:<br>
                                    1. Trykk p√• <strong>Del-knappen</strong> (‚ÜóÔ∏è) i Safari<br>
                                    2. Velg <strong>"Legg til p√• Hjem-skjerm"</strong><br>
                                    3. √Öpne appen fra hjemskjermen
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Legens plan -->
                <button class="btn btn-white w-100 border-0 shadow-sm rounded-4 mb-3 p-3 d-flex align-items-center justify-content-between text-start" onclick="addDoctorPlan()">
                    <div class="d-flex align-items-center gap-3">
                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <i class="bi bi-file-medical-fill fs-4"></i>
                        </div>
                        <div>
                            <div class="fw-bold text-dark">Legens plan</div>
                            <div class="small text-muted">Last inn standard tider fra sykehuset</div>
                        </div>
                    </div>
                    <i class="bi bi-cloud-download text-primary fs-5"></i>
                </button>
                
                <!-- Egen doseringsplan -->
                <div class="card border-0 shadow-sm rounded-4 mb-4">
                    <div class="card-header bg-white border-0 pt-3 pb-2 d-flex justify-content-between align-items-center rounded-top-4">
                        <h6 class="fw-bold mb-0 d-flex align-items-center gap-2">
                            <i class="bi bi-sliders text-primary"></i> Egen plan
                        </h6>
                        <button class="btn btn-sm btn-light text-primary fw-bold rounded-pill border-0 shadow-sm" onclick="showCustomPlanBuilder()">
                            <i class="bi bi-plus-lg me-1"></i> Ny
                        </button>
                    </div>
                    <div class="card-body pt-0">
                        <div id="customPlanList">
                            <div class="text-center py-4 text-muted small bg-light rounded-3 border border-light">
                                <i class="bi bi-calendar-x fs-4 d-block mb-2 opacity-50"></i>
                                Ingen egendefinerte planer enn√•
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Legg til ny p√•minnelse -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden bg-white">
                    <div class="card-body p-4">
                        <h6 class="fw-bold mb-3 d-flex align-items-center gap-2 text-dark">
                            <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="bi bi-alarm-fill"></i>
                            </div>
                            Ny p√•minnelse
                        </h6>
                        <form id="reminderForm">
                            <div class="d-flex flex-column gap-3">
                                <input type="text" class="form-control form-control-lg bg-light border-0 text-dark shadow-none" 
                                       id="reminderName" 
                                       placeholder="Hva skal huskes?" 
                                       required>
                                <div class="row g-3">
                                    <div class="col-7">
                                        <div class="form-floating">
                                            <input type="time" class="form-control bg-light border-0 text-dark shadow-none" id="reminderTime" required placeholder="Tid">
                                            <label for="reminderTime" class="text-secondary">Tidspunkt</label>
                                        </div>
                                    </div>
                                    <div class="col-5 d-flex align-items-stretch">
                                        <button type="submit" class="btn btn-primary fw-bold w-100 shadow-sm rounded-3" style="border: none;">
                                            <i class="bi bi-plus-lg"></i> Legg til
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Liste over aktive p√•minnelser -->
                <div class="d-flex align-items-center justify-content-between mb-3 mt-4">
                    <h6 class="fw-bold mb-0 text-primary">
                        <i class="bi bi-bell me-2"></i>Aktive p√•minnelser
                    </h6>
                    <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill px-3" id="activeRemindersCount">
                        <!-- Count populated by JS -->
                    </span>
                </div>
                <div id="reminderList" class="d-flex flex-column gap-3"></div>
            </div>
            
            <!-- Statistikk Tab -->
            <div class="tab-pane fade" id="stats" role="tabpanel">
                <!-- Premium Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: var(--purple-gradient);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">Statistikk</h5>
                            <p class="mb-0 opacity-75 small">Oversikt og trender</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">üìä</span>
                        </div>
                    </div>
                </div>

                <!-- Date Filter -->
                <div class="card border-0 shadow-sm p-2 mb-4 rounded-4 bg-white overflow-hidden">
                    <div class="card-body p-2">
                        <div class="input-group input-group-sm bg-light rounded-pill p-1 border">
                            <span class="input-group-text bg-transparent border-0 text-muted ps-3"><i class="bi bi-calendar-range"></i></span>
                            <input type="date" id="statsDate" class="form-control bg-transparent border-0 shadow-none text-muted fw-bold" style="font-size: 0.9rem;">
                        </div>
                    </div>
                </div>
                
                <div id="statsContent" class="d-flex flex-column gap-3"></div>
            </div>
            
            <!-- Timers Tab -->
            <div class="tab-pane fade" id="timers" role="tabpanel">
                <!-- Header -->
                <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                    <div class="card-body p-4 text-white d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="mb-1 fw-bold">Aktive Timere</h5>
                            <p class="mb-0 opacity-75 small">Infusjoner og tidsstyring</p>
                        </div>
                        <div class="bg-white bg-opacity-25 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                            <span style="font-size: 1.5rem;">‚è±Ô∏è</span>
                        </div>
                    </div>
                </div>

                <!-- Active Timers List -->
                <div id="activeTimersList" class="d-flex flex-column gap-3 mb-4">
                    <!-- Injected by JS -->
                </div>

                <!-- Add Timer Button -->
                <button class="btn btn-primary w-100 rounded-pill fw-bold py-3 shadow-sm" style="background: var(--accent-gradient); border: none;" data-bs-toggle="modal" data-bs-target="#addTimerModal">
                    <i class="bi bi-plus-lg me-2"></i>Start ny timer
                </button>
            </div>
        </div>
        
        <!-- Add Timer Modal -->
        <div class="modal fade" id="addTimerModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg rounded-4">
                    <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); border-radius: 24px 24px 0 0;">
                        <h5 class="modal-title fw-bold"><i class="bi bi-stopwatch me-2"></i>Ny Timer</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <!-- Presets Section -->
                        <div class="mb-4">
                            <label class="form-label fw-bold text-secondary small text-uppercase">Hurtigvalg / Maler</label>
                            <div id="presetList" class="d-flex flex-wrap gap-1">
                                <!-- Injected by JS -->
                            </div>
                        </div>

                        <form id="newTimerForm" onsubmit="event.preventDefault(); createTimer(document.getElementById('timerName').value, document.getElementById('timerMinutes').value, document.getElementById('timerVolume').value, document.getElementById('alarmBeforeRange').value, document.getElementById('saveAsPreset').checked)">
                            <div class="mb-3">
                                <label for="timerName" class="form-label fw-bold">Navn p√• timer *</label>
                                <input type="text" class="form-control form-control-lg bg-light border-0" id="timerName" required placeholder="F.eks. Antibiotika">
                            </div>
                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label for="timerMinutes" class="form-label fw-bold">Tid (min) *</label>
                                    <input type="number" class="form-control form-control-lg bg-light border-0" id="timerMinutes" required min="1" placeholder="30">
                                </div>
                                <div class="col-6 mb-3">
                                    <label for="timerVolume" class="form-label fw-bold">Volum (ml)</label>
                                    <input type="number" class="form-control form-control-lg bg-light border-0" id="timerVolume" min="0" placeholder="100">
                                </div>
                            </div>
                            
                            <!-- Alarm Before -->
                            <div class="card border-0 bg-light p-3 rounded-4 mb-4">
                                <label for="alarmBeforeRange" class="form-label fw-bold d-flex justify-content-between">
                                    <span>Varsle f√∏r slutt</span>
                                    <span class="text-primary" id="alarmBeforeValue">0 min</span>
                                </label>
                                <input type="range" class="form-range" id="alarmBeforeRange" min="0" max="30" step="1" value="0" oninput="document.getElementById('alarmBeforeValue').textContent = this.value + ' min'">
                                <div class="form-text small mt-0">Dra for √• sette varsel f√∏r tiden er ute (0 = av)</div>
                            </div>

                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="saveAsPreset">
                                <label class="form-check-label" for="saveAsPreset">
                                    Lagre som mal for senere bruk
                                </label>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg rounded-pill shadow-sm fw-bold" style="background: var(--accent-gradient); border: none;">
                                    Start timer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal fade" id="settingsModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg rounded-4">
                    <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #607D8B, #455A64); border-radius: 24px 24px 0 0;">
                        <h5 class="modal-title fw-bold"><i class="bi bi-gear-fill me-2"></i>Innstillinger</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <h6 class="fw-bold text-secondary text-uppercase small mb-3">Utseende</h6>
                        <div class="card border-0 shadow-sm p-3 rounded-4 mb-4 bg-light">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-dark text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-moon-stars-fill"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">M√∏rk modus</div>
                                        <div class="small text-muted">Bytt mellom lyst og m√∏rkt tema</div>
                                    </div>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="darkModeToggle" style="width: 3em; height: 1.5em; cursor: pointer;">
                                </div>
                            </div>
                        </div>

                        <h6 class="fw-bold text-secondary text-uppercase small mb-3">Data & Eksport</h6>
                        <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 mb-3 d-flex align-items-center justify-content-between" onclick="exportToCSV()">
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <i class="bi bi-file-earmark-spreadsheet fs-5"></i>
                                </div>
                                <div>
                                    <div class="fw-bold text-dark">Eksporter til CSV</div>
                                    <div class="small text-muted">Last ned alle data til Excel</div>
                                </div>
                            </div>
                            <i class="bi bi-download text-secondary"></i>
                        </button>

                        <hr class="my-4 opacity-10">

                        <h6 class="fw-bold text-secondary text-uppercase small mb-3">System & Varsler</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 d-flex align-items-center justify-content-between" onclick="sendTestPushNotification()">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-bell fs-5"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">Test Push-varsel</div>
                                        <div class="small text-muted">Send en testmelding</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-right text-secondary"></i>
                            </button>
                            
                            <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 d-flex align-items-center justify-content-between" onclick="fetchPushStatus()">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-info bg-opacity-10 text-info rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-info-circle fs-5"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">Status Push-tjeneste</div>
                                        <div class="small text-muted">Sjekk tilkobling</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-right text-secondary"></i>
                            </button>

                            <button class="btn btn-light border-0 shadow-sm w-100 text-start p-3 rounded-4 d-flex align-items-center justify-content-between" onclick="sendTestDailyReport()">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="bi bi-envelope fs-5"></i>
                                    </div>
                                    <div>
                                        <div class="fw-bold text-dark">Test E-postrapport</div>
                                        <div class="small text-muted">Send daglig rapport n√•</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-right text-secondary"></i>
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer border-0 px-4 pb-4 pt-0">
                        <button type="button" class="btn btn-secondary w-100 rounded-pill py-2 fw-bold" data-bs-dismiss="modal">Lukk</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Bowel Movement Modal -->
    <div class="modal fade" id="bowelModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #795548, #5D4037); border-radius: 24px 24px 0 0;">
                    <h5 class="modal-title fw-bold"><i class="bi bi-chat-square-text me-2"></i>Logg avf√∏ring</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Mengde</label>
                        <select class="form-select form-select-lg shadow-sm border-0 bg-light" id="quickBmAmount">
                            <option value="Liten">Liten</option>
                            <option value="Middels" selected>Middels</option>
                            <option value="Stor">Stor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Konsistens</label>
                        <select class="form-select shadow-sm border-0 bg-light" id="quickBmConsistency" style="padding-top: 12px; padding-bottom: 12px;">
                            <option value="Type 1: Separate hard lumps, like nuts (hard to pass)">Type 1: Harde klumper</option>
                            <option value="Type 2: Sausage-shaped but lumpy">Type 2: P√∏lseformet men klumpete</option>
                            <option value="Type 3: Like a sausage but with cracks on the surface">Type 3: P√∏lse med sprekker</option>
                            <option value="Type 4: Like a sausage or snake, smooth and soft" selected>Type 4: Normal (glatt og myk)</option>
                            <option value="Type 5: Soft blobs with clear-cut edges">Type 5: Myke klumper</option>
                            <option value="Type 6: Fluffy pieces with ragged edges, a mushy stool">Type 6: Gr√∏tete</option>
                            <option value="Type 7: Watery, no solid pieces, entirely liquid">Type 7: Vandig/diar√©</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Farge (valgfritt)</label>
                        <input type="text" class="form-control shadow-sm border-0 bg-light" id="quickBmColor" placeholder="f.eks. Brun, Gr√∏nn">
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <button type="button" class="btn btn-light text-muted fw-bold px-4 rounded-pill" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white fw-bold px-5 rounded-pill shadow-sm flex-grow-1" style="background: linear-gradient(135deg, #795548, #5D4037);" onclick="submitQuickBowelMovement()">
                        <i class="bi bi-check-lg me-1"></i> Lagre
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick vannlating Modal -->
    <div class="modal fade" id="vannlatingModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #039BE5, #0277BD); border-radius: 24px 24px 0 0;">
                    <h5 class="modal-title fw-bold"><i class="bi bi-droplet-fill me-2"></i>Logg vannlating</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Mengde</label>
                        <select class="form-select form-select-lg shadow-sm border-0 bg-light" id="quickUrineAmount">
                            <option value="Liten">Liten</option>
                            <option value="Middels" selected>Middels</option>
                            <option value="Stor">Stor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Farge</label>
                        <select class="form-select shadow-sm border-0 bg-light" id="quickUrineColor" style="padding-top: 12px; padding-bottom: 12px;">
                            <option value="Klar">Klar</option>
                            <option value="Lys gul" selected>Lys gul</option>
                            <option value="M√∏rk gul">M√∏rk gul</option>
                            <option value="R√∏dlig">R√∏dlig</option>
                            <option value="Annet">Annet</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Lukt (valgfritt)</label>
                        <input type="text" class="form-control shadow-sm border-0 bg-light" id="quickUrineSmell" placeholder="f.eks. Normal, Sterk">
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <button type="button" class="btn btn-light text-muted fw-bold px-4 rounded-pill" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white fw-bold px-5 rounded-pill shadow-sm flex-grow-1" style="background: linear-gradient(135deg, #039BE5, #0277BD);" onclick="submitQuickvannlating()">
                        <i class="bi bi-check-lg me-1"></i> Lagre
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- User Selector Modal -->
    <div class="modal fade" id="userSelectorModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-white text-center d-block border-0 pb-0" style="background: var(--primary-gradient);">
                    <img src="./logo.svg" alt="Dosevakt" style="height: 60px; margin-bottom: 12px; filter: brightness(0) invert(1);">
                    <h5 class="modal-title">Hvem er du?</h5>
                </div>
                <div class="modal-body pt-4">
                    <div id="defaultUsersContainer" class="d-grid gap-2"></div>
                    <div id="savedUsersContainer" class="d-grid gap-2 mt-2"></div>
                    
                    <div class="mt-4 pt-4 border-top">
                        <label class="form-label small text-muted">Legg til ny bruker:</label>
                        <div class="input-group">
                            <input type="text" id="customUserInput" class="form-control" placeholder="Navn...">
                            <button class="btn text-white" style="background: var(--primary-gradient);" onclick="showAddUserModal(document.getElementById('customUserInput').value)">
                                OK
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-white" style="background: var(--primary-gradient);">
                    <h5 class="modal-title">üë§ <span id="addUserModalTitle">Ny bruker</span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editingUserId">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Navn *</label>
                        <input type="text" id="newUserName" class="form-control" placeholder="Ditt navn">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">E-post (valgfritt)</label>
                        <input type="email" id="newUserEmail" class="form-control" placeholder="din@epost.no">
                        <div class="form-text">For √• motta daglig rapport og varsler</div>
                    </div>
                    
                    <div class="bg-light p-3 rounded-3 mb-3">
                        <h6 class="fw-bold mb-3">üìß E-postvarsler</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="newUserDailyReport">
                            <label class="form-check-label" for="newUserDailyReport">
                                <div>Daglig rapport</div>
                                <small class="text-muted">Motta oppsummering kl. 22:00</small>
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="newUserMissedMedAlert">
                            <label class="form-check-label" for="newUserMissedMedAlert">
                                <div>Glemt medisin-varsel</div>
                                <small class="text-muted">Varsles hvis medisin ikke er gitt 10 min etter tidspunkt</small>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAddUserModal()">Avbryt</button>
                    <button type="button" class="btn text-white" style="background: var(--primary-gradient);" onclick="saveUser()">Lagre</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Vomit Modal -->
    <div class="modal fade" id="vomitModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header text-white border-0" style="background: linear-gradient(135deg, #E53935, #C62828); border-radius: 24px 24px 0 0;">
                    <h5 class="modal-title fw-bold"><i class="bi bi-exclamation-triangle-fill me-2"></i>Logg oppkast</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Mengde</label>
                        <select class="form-select form-select-lg shadow-sm border-0 bg-light" id="quickVomitAmount">
                            <option value="Liten">Liten (gulp)</option>
                            <option value="Middels" selected>Middels</option>
                            <option value="Stor">Stor</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Farge/Innhold</label>
                        <input type="text" class="form-control shadow-sm border-0 bg-light" id="quickVomitColor" placeholder="f.eks. Uford√∏yd mat, slim, gult">
                    </div>
                    <div class="mb-2">
                        <label class="form-label fw-bold text-secondary small text-uppercase">Tidspunkt</label>
                        <input type="datetime-local" class="form-control shadow-sm border-0 bg-light" id="quickVomitTime">
                    </div>
                </div>
                <div class="modal-footer border-0 px-4 pb-4">
                    <button type="button" class="btn btn-light text-muted fw-bold px-4 rounded-pill" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white fw-bold px-5 rounded-pill shadow-sm flex-grow-1" style="background: linear-gradient(135deg, #E53935, #C62828);" onclick="quickLogVomit()">
                        <i class="bi bi-check-lg me-1"></i> Logg oppkast
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Medicine to Checklist Modal -->
    <div class="modal fade" id="addMedicineModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-white" style="background: var(--primary-gradient);">
                    <h5 class="modal-title">üíä Legg til ny medisin</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3 position-relative">
                  <label class="form-label fw-bold">Medisinnavn *</label>
                  <input type="text" class="form-control" id="newMedicineName" placeholder="F.eks. Marevan" required autocomplete="off">
                  <div id="medicineSuggestions" class="list-group position-absolute w-100 shadow" style="display: none; max-height: 200px; overflow-y: auto; z-index: 1050; top: 100%;"></div>
                </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Dose/mengde</label>
                        <input type="text" class="form-control" id="newMedicineDose" placeholder="F.eks. 10 ml, 1 tablett">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Kategori *</label>
                        <div class="d-grid gap-2" style="grid-template-columns: 1fr 1fr;">
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="dag" class="form-check-input mt-0">
                                <span>üåÖ Morgen</span>
                            </label>
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="kveld" class="form-check-input mt-0">
                                <span>üåô Kveld</span>
                            </label>
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="both" class="form-check-input mt-0">
                                <span>üîÑ Begge</span>
                            </label>
                            <label class="btn btn-outline-light text-dark d-flex align-items-center gap-2 text-start border">
                                <input type="radio" name="medicineCategory" value="prn" checked class="form-check-input mt-0">
                                <span>üéØ Ved behov</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Tidspunkt (valgfritt)</label>
                        <input type="time" class="form-control" id="newMedicineTime">
                        <small class="text-muted">Legg til klokkeslett hvis medisinen skal tas til fast tid</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn btn-success" onclick="addNewMedicineToChecklist()" style="padding: 12px 24px;">
                        ‚úì Legg til
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Sondemat to Checklist Modal -->
    <div class="modal fade" id="addSondematModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header text-white" style="background: linear-gradient(135deg, #42A5F5, #2196F3);">
                    <h5 class="modal-title">üçº Legg til ny sondemat</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="newSondematName" class="form-label fw-bold">Sondematenavn *</label>
                        <input type="text" class="form-control" id="newSondematName" placeholder="F.eks. Fresubin" required>
                    </div>
                    <div class="mb-3">
                        <label for="newSondematAmount" class="form-label fw-bold">Mengde</label>
                        <input type="text" class="form-control" id="newSondematAmount" placeholder="F.eks. 500 ml">
                    </div>
                    <div class="mb-3">
                        <label for="newSondematFrequency" class="form-label fw-bold">Frekvens</label>
                        <input type="text" class="form-control" id="newSondematFrequency" placeholder="F.eks. 3x daglig">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn text-white" style="background: linear-gradient(135deg, #42A5F5, #2196F3);" onclick="addNewSondematToChecklist()">
                        üíæ Lagre
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom Plan Builder Modal -->
    <div class="modal fade" id="customPlanModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚öôÔ∏è Lag egen doseringsplan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="customPlanName" class="form-label">Navn p√• plan *</label>
                        <input type="text" class="form-control" id="customPlanName" placeholder="F.eks. Mari sin morgenrutine" required>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">Velg medisiner og tidspunkter:</h6>
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="addCustomMedicineField()">
                            ‚ûï Legg til ny medisin
                        </button>
                    </div>
                    <div id="medicineTimePicker" style="max-height: 400px; overflow-y: auto;">
                        <!-- Generated dynamically -->
                    </div>
                    <div id="customMedicineContainer" class="mt-3">
                        <!-- Custom medicines will be added here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomPlan()">
                        üíæ Lagre plan
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Offcanvas Menu -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel" style="border-radius: 0 20px 20px 0; border: none; box-shadow: 5px 0 30px rgba(0,0,0,0.1);">
        <div class="offcanvas-header" style="background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); color: white; padding: 24px;">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel" style="display: flex; align-items: center; gap: 16px; font-weight: 700; font-size: 1.5rem;">
                <img src="./logo.svg" alt="Logo" style="height: 40px; filter: brightness(0) invert(1);">
                Dosevakt
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body" style="padding: 0;">
            <!-- User Profile Section -->
            <div style="text-align: center; padding: 32px 20px; background: #f8f9fa; border-bottom: 1px solid #eee;">
                <div style="width: 88px; height: 88px; background: white; border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 3rem; box-shadow: 0 8px 24px rgba(0,0,0,0.08);">
                    üë§
                </div>
                <h4 id="offcanvasUserName" style="margin-bottom: 4px; font-weight: 700; color: #333;">Bruker</h4>
                <p style="color: #666; font-size: 0.95rem; margin-bottom: 24px;">Innlogget bruker</p>
                <button onclick="switchUser()" class="btn btn-outline-primary rounded-pill px-4 py-2" data-bs-dismiss="offcanvas" style="font-weight: 600;">
                    <i class="bi bi-arrow-repeat me-2"></i>Bytt bruker
                </button>
            </div>

            <!-- Menu Items -->
            <div class="list-group list-group-flush p-3 gap-2">
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('home-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E3F2FD; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #2196F3; font-size: 1.2rem;">
                        <i class="bi bi-house-door-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Hjem</span>
                </button>
                
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('checklist-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E8F5E9; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #4CAF50; font-size: 1.2rem;">
                        <i class="bi bi-check-square-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Sjekkliste</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('log-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #FFF3E0; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #FF9800; font-size: 1.2rem;">
                        <i class="bi bi-plus-circle-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Ny Logg</span>
                </button>
                
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('today-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #FFF8E1; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #FFC107; font-size: 1.2rem;">
                        <i class="bi bi-calendar-event-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">I dag</span>
                </button>
                
                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('history-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #F3E5F5; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #9C27B0; font-size: 1.2rem;">
                        <i class="bi bi-clock-history"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Historikk</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('reminders-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E0F7FA; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #00BCD4; font-size: 1.2rem;">
                        <i class="bi bi-bell-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">P√•minnelser</span>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('timers-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E3F2FD; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #2196F3; font-size: 1.2rem;">
                        <i class="bi bi-stopwatch-fill"></i>
                    </div>
                    <div class="d-flex justify-content-between align-items-center flex-grow-1">
                        <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Timere</span>
                        <span class="badge bg-primary rounded-pill" id="menuTimersBadge" style="display: none;"></span>
                    </div>
                </button>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" onclick="document.getElementById('stats-tab').click(); bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #E8EAF6; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #3F51B5; font-size: 1.2rem;">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Statistikk</span>
                </button>
                
                <div class="border-top my-2"></div>

                <button class="list-group-item list-group-item-action border-0 rounded-4 px-3 py-3 d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#settingsModal" onclick="bootstrap.Offcanvas.getInstance(document.getElementById('offcanvasNavbar')).hide()">
                    <div style="width: 40px; height: 40px; background: #F5F5F5; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; color: #616161; font-size: 1.2rem;">
                        <i class="bi bi-gear-fill"></i>
                    </div>
                    <span style="font-weight: 600; color: #333; font-size: 1.05rem;">Innstillinger</span>
                </button>
            </div>
            
            <div style="margin-top: auto; padding: 24px; text-align: center;">
                <p style="color: #ccc; font-size: 0.8rem; margin: 0; font-weight: 500;">Dosevakt v1.2.0</p>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
    
    <!-- Firebase Config -->
    <script src="firebase-config.js?v=18"></script>

    <!-- App Config -->
    <script src="config.js?v=18"></script>
    
    <!-- Medicine Info -->
    <script src="medicine-info.js?v=18"></script>
    
    <!-- Utils (Helper functions) -->
    <script src="utils.js?v=18"></script>

    <!-- Data Management -->
    <script src="data.js?v=18"></script>

    <!-- UI Rendering -->
    <script src="ui.js?v=18"></script>
    
    <!-- App JS -->
    <script src="app.js?v=18"></script>
    
    <!-- Dosing Plan JS -->
    <script src="dosing-plan.js?v=18"></script>
    
    <!-- Timers JS -->
    <script src="timers.js?v=1"></script>
    
    <!-- Service Worker Cleanup -->
    <script>
        // Unregister conflicting service workers to fix reload loops and caching issues
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                for (let registration of registrations) {
                    // Check if this is the caching service worker (sw.js)
                    // We want to keep firebase-messaging-sw.js for push notifications
                    const scriptUrl = (registration.active && registration.active.scriptURL) ||
                                    (registration.waiting && registration.waiting.scriptURL) ||
                                    (registration.installing && registration.installing.scriptURL) ||
                                    '';
                    
                    if (scriptUrl.includes('/sw.js')) {
                        console.log('Unregistering conflicting service worker:', scriptUrl);
                        registration.unregister()
                            .then(success => console.log('Service Worker unregistered:', success))
                            .catch(error => console.error('Service Worker unregister failed:', error));
                    }
                }
            });
        }

        window.addEventListener('load', () => {
            if (typeof initializeFirebase === 'function') {
                initializeFirebase();
            }
        });
    </script>
    
    <!-- Bottom Navigation -->
    <nav style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); box-shadow: 0 -1px 20px rgba(0,0,0,0.08); z-index: 1020; padding: 8px 0 max(8px, env(safe-area-inset-bottom));">
        <div style="display: flex; justify-content: space-around; align-items: center; max-width: 500px; margin: 0 auto;">
            <button type="button" onclick="document.getElementById('checklist-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-list-check" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">Sjekk</span>
            </button>
            <button type="button" onclick="document.getElementById('today-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-calendar-day" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">I dag</span>
            </button>
            <button type="button" onclick="document.getElementById('log-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 0; display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                <div style="background: linear-gradient(135deg, #4CAF50, #81C784); width: 52px; height: 52px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(76,175,80,0.4); margin-top: -20px;">
                    <i class="bi bi-plus-lg" style="font-size: 1.5rem; color: white;"></i>
                </div>
            </button>
            <button type="button" onclick="document.getElementById('reminders-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-bell" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">P√•minn</span>
            </button>
            <button type="button" onclick="document.getElementById('history-tab').click()" 
                    style="flex: 1; background: none; border: none; padding: 6px 0; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer;">
                <i class="bi bi-clock-history" style="font-size: 1.3rem;"></i>
                <span style="font-size: 0.65rem; font-weight: 500;">Historikk</span>
            </button>
        </div>
    </nav>
</body>
</html>

